<%*
// κ°•μ μ²΄ν¬λ°•μ¤ ν† κΈ€ μ‹ μλ™ μ§„λ„ μ—…λ°μ΄νΈ
const currentFile = tp.file.path(true);

// μ™„λ£λ κµ¬κ°„ κ°μ κ³„μ‚°
const content = await app.vault.read(app.vault.getAbstractFileByPath(currentFile));
const completedSegments = (content.match(/- \[x\] \*\*ν•™μµ μ™„λ£\*\* β…/g) || []).length;
const totalSegments = (content.match(/- \[.\] \*\*ν•™μµ μ™„λ£\*\* β…/g) || []).length;

// YAML frontmatter μ—…λ°μ΄νΈ
let newContent = content;

// completed-segments μ—…λ°μ΄νΈ
if (newContent.includes('completed-segments::')) {
    newContent = newContent.replace(/completed-segments::\s*\d+/, `completed-segments:: ${completedSegments}`);
}

// μƒνƒ μ—…λ°μ΄νΈ
let status = "λ―Έμ‹μ‘";
if (completedSegments === totalSegments && totalSegments > 0) {
    status = "μ™„λ£";
} else if (completedSegments > 0) {
    status = "μ§„ν–‰μ¤‘";
}

if (newContent.includes('status::')) {
    newContent = newContent.replace(/status::\s*\S+/, `status:: ${status}`);
}

// νμΌ μ—…λ°μ΄νΈ
await app.vault.modify(app.vault.getAbstractFileByPath(currentFile), newContent);

// μ™„λ£ λ©”μ‹μ§€
if (completedSegments === totalSegments && totalSegments > 0) {
    new Notice("π‰ κ°•μ ν•™μµμ΄ μ™„λ£λμ—μµλ‹λ‹¤!");
} else if (completedSegments > 0) {
    new Notice(`π“ ${completedSegments}/${totalSegments} κµ¬κ°„ μ™„λ£! (${Math.round(completedSegments/totalSegments*100)}%)`);
}
%>

# π“ μ§„λ„ μ—…λ°μ΄νΈ μ™„λ£

ν„μ¬ μ§„ν–‰λ¥ μ΄ μλ™μΌλ΅ μ—…λ°μ΄νΈλμ—μµλ‹λ‹¤:
- **μ™„λ£ κµ¬κ°„**: <%= completedSegments %>/<%= totalSegments %>
- **μ§„ν–‰λ¥ **: <%= Math.round(completedSegments/totalSegments*100) %>%
- **μƒνƒ**: <%= status %>

[[π“ κ°•μν•™μµ λ€μ‹λ³΄λ“]]μ—μ„ μ „μ²΄ μ§„ν–‰ ν„ν™©μ„ ν™•μΈν•  μ μμµλ‹λ‹¤.
