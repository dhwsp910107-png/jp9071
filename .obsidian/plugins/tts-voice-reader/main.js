/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// main.ts
var main_exports = {};
__export(main_exports, {
  default: () => TTSVoiceReaderPlugin
});
module.exports = __toCommonJS(main_exports);
var import_obsidian = require("obsidian");
function isElectronApp() {
  try {
    const ua = navigator.userAgent || "";
    if (ua.includes("Electron"))
      return true;
    if (typeof window.require === "function") {
      return true;
    }
  } catch (e) {
  }
  return false;
}
function isMobileApp() {
  try {
    const ua = navigator.userAgent || "";
    return /Android|iPhone|iPad|iPod/.test(ua) && !ua.includes("Electron");
  } catch (e) {
    return false;
  }
}
var DEFAULT_SETTINGS = {
  browserVoice: "",
  speed: 1,
  pitch: 1,
  volume: 1,
  autoSaveAudio: false,
  outputFolder: "TTS Audio/Text",
  audioFolder: "TTS Audio/Voice",
  dashboardFolder: "TTS Dashboard"
};
var TTSVoiceReaderPlugin = class extends import_obsidian.Plugin {
  constructor() {
    super(...arguments);
    this.currentUtterance = null;
    this.isPlaying = false;
    this.availableVoices = [];  // ë¸Œë¼ìš°ì € ìŒì„± ë¦¬ìŠ¤íŠ¸
    this.browserVoices = [];     // ë¸Œë¼ìš°ì € speechSynthesis ìŒì„±
    this.mediaRecorder = null;
    this.recordedChunks = [];
    this.currentAudio = null;
    this.currentSpeakingText = "";
  }
  
  // í˜„ì¬ ì½ê³  ìˆëŠ” í…ìŠ¤íŠ¸ (ìë™ ì €ì¥ìš©)
  async onload() {
    await this.loadSettings();
    
    console.log("ğŸš€ TTS í”ŒëŸ¬ê·¸ì¸ ë¡œë”© ì‹œì‘ (PCìš© - ë¸Œë¼ìš°ì € TTS)");
    
    // speechSynthesis ì²´í¬ ë° ì´ˆê¸°í™”
    if (typeof window !== "undefined" && "speechSynthesis" in window) {
      this.synthesis = window.speechSynthesis;
      console.log("âœ… speechSynthesis ì‚¬ìš© ê°€ëŠ¥");
      
      // speechSynthesis ì´ˆê¸°í™”
      this.synthesis.cancel();
      
      // ë¸Œë¼ìš°ì € ìŒì„± ë¡œë“œ
      await this.loadVoices();
      
      if (window.speechSynthesis && window.speechSynthesis.onvoiceschanged !== void 0) {
        window.speechSynthesis.onvoiceschanged = () => {
          console.log("ğŸ”„ onvoiceschanged ì´ë²¤íŠ¸ ë°œìƒ");
          this.loadVoices();
        };
      }
    } else {
      this.synthesis = null;
      console.log("âš ï¸ speechSynthesis ë¯¸ì§€ì›");
    }
    this.addRibbonIcon("mic", "TTS \uC74C\uC131 \uC77D\uAE30", () => {
      const activeView = this.app.workspace.getActiveViewOfType(import_obsidian.MarkdownView);
      if (activeView) {
        const editor = activeView.editor;
        const selectedText = editor.getSelection();
        if (selectedText) {
          this.speakText(selectedText);
        } else {
          new TTSReaderModal(this.app, this).open();
        }
      } else {
        new TTSReaderModal(this.app, this).open();
      }
    });
    this.addRibbonIcon("layout-dashboard", "TTS \uB300\uC2DC\uBCF4\uB4DC", () => {
      new TTSDashboardModal(this.app, this).open();
    });
    this.addRibbonIcon("file-audio", "TXT â†’ MP3 ë³€í™˜", () => {
      new TxtToMp3Modal(this.app, this).open();
    });
    this.addCommand({
      id: "speak-selection",
      name: "\uC120\uD0DD\uD55C \uD14D\uC2A4\uD2B8 \uC77D\uAE30",
      editorCallback: (editor) => {
        const text = editor.getSelection();
        if (text) {
          this.speakText(text);
        } else {
          new import_obsidian.Notice("\uD14D\uC2A4\uD2B8\uB97C \uC120\uD0DD\uD574\uC8FC\uC138\uC694");
        }
      }
    });
    this.addCommand({
      id: "speak-entire-note",
      name: "\uC804\uCCB4 \uB178\uD2B8 \uC77D\uAE30",
      editorCallback: (editor) => {
        const text = editor.getValue();
        this.speakText(text);
      }
    });
    this.addCommand({
      id: "stop-speaking",
      name: "\uC74C\uC131 \uC77D\uAE30 \uC815\uC9C0",
      callback: () => {
        this.stopSpeaking();
      }
    });
    this.addCommand({
      id: "pause-resume-speaking",
      name: "\uC74C\uC131 \uC77D\uAE30 \uC77C\uC2DC\uC815\uC9C0/\uC7AC\uAC1C",
      callback: () => {
        this.togglePause();
      }
    });
    this.addCommand({
      id: "record-voice",
      name: "\uB0B4 \uC74C\uC131 \uB179\uC74C\uD558\uAE30",
      callback: () => {
        new VoiceRecordModal(this.app, this).open();
      }
    });
    this.addCommand({
      id: "create-dashboard",
      name: "TTS \uB300\uC2DC\uBCF4\uB4DC \uC0DD\uC131",
      callback: async () => {
        await this.createDashboard();
      }
    });
    this.addCommand({
      id: "read-txt-file",
      name: "TXT \uD30C\uC77C \uB0B4\uC6A9 \uC77D\uAE30",
      editorCallback: async (editor, view) => {
        await this.readCurrentTxtFile(view);
      }
    });
    this.addCommand({
      id: "convert-txt-to-mp3",
      name: "TXT â†’ MP3 ë³€í™˜",
      callback: () => {
        new TxtToMp3Modal(this.app, this).open();
      }
    });
    this.registerEvent(
      this.app.workspace.on("file-open", async (file) => {
        if (file && file.extension === "txt" && file.path.includes(this.settings.outputFolder)) {
          const content = await this.app.vault.read(file);
          const textContent = this.extractTextFromTTSFile(content);
          if (textContent) {
            new import_obsidian.Notice(`\u{1F4D6} "${file.basename}" \uD30C\uC77C\uC744 \uC77D\uC2B5\uB2C8\uB2E4`);
            this.speakText(textContent);
          }
        }
      })
    );
    this.addSettingTab(new TTSSettingTab(this.app, this));
    this.registerEvent(
      this.app.workspace.on("editor-menu", (menu, editor) => {
        const selection = editor.getSelection();
        if (selection) {
          menu.addItem((item) => {
            item.setTitle("\u{1F50A} \uC120\uD0DD\uD55C \uD14D\uC2A4\uD2B8 \uC77D\uAE30").setIcon("mic").onClick(() => {
              this.speakText(selection);
            });
          });
        }
      })
    );
  }
  async loadVoicesFromServer() {
    // ë” ì´ìƒ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ - ë¸Œë¼ìš°ì € TTSë§Œ ì‚¬ìš©
    return false;
  }
  async loadVoices() {
    var _a;
    
    console.log("ğŸ”„ ë¸Œë¼ìš°ì € TTS ìŒì„± ëª©ë¡ ë¡œë“œ ì‹œì‘");
    
    if (this.synthesis) {
      // speechSynthesis ì´ˆê¸°í™” ë³´ì¥
      this.synthesis.cancel();
      
      let voices = this.synthesis.getVoices();
      console.log(`ğŸ“Š ì´ˆê¸° ë¸Œë¼ìš°ì € ìŒì„± ê°œìˆ˜: ${voices.length}`);
      
      if (voices.length === 0) {
        console.log("â³ ìŒì„± ëª©ë¡ì´ ë¹„ì–´ìˆìŒ. ë¹„ë™ê¸° ë¡œë”© ëŒ€ê¸°...");
        
        // Promiseë¡œ ìŒì„± ë¡œë”© ëŒ€ê¸°
        voices = await new Promise((resolve) => {
          // onvoiceschanged ì´ë²¤íŠ¸ë¡œ ìŒì„± ë¡œë”© ì™„ë£Œ ê°ì§€
          if (this.synthesis.onvoiceschanged !== undefined) {
            this.synthesis.onvoiceschanged = () => {
              const loadedVoices = this.synthesis.getVoices();
              console.log(`âœ… onvoiceschanged: ${loadedVoices.length}ê°œ ë¡œë“œë¨`);
              resolve(loadedVoices);
            };
          }
          
          // íƒ€ì„ì•„ì›ƒ (1ì´ˆ í›„ì—ë„ ë¡œë“œ ì•ˆ ë˜ë©´ ê°•ì œ ì‹œë„)
          setTimeout(() => {
            const currentVoices = this.synthesis.getVoices();
            console.log(`â±ï¸ íƒ€ì„ì•„ì›ƒ í›„ ìŒì„± ê°œìˆ˜: ${currentVoices.length}`);
            if (currentVoices.length > 0) {
              resolve(currentVoices);
            } else {
              console.warn("âš ï¸ 1ì´ˆ ëŒ€ê¸° í›„ì—ë„ ìŒì„± ì—†ìŒ. ë¹ˆ ë°°ì—´ ë°˜í™˜.");
              resolve([]);
            }
          }, 1000);
        });
      }
      
      this.browserVoices = voices;
      this.availableVoices = voices;
      
      if (voices.length > 0) {
        console.log(`âœ… ë¸Œë¼ìš°ì € TTS ìŒì„± ë¡œë“œ ì™„ë£Œ: ${voices.length}ê°œ`);
        console.log("ì‚¬ìš© ê°€ëŠ¥í•œ ë¸Œë¼ìš°ì € ìŒì„±:", voices.slice(0, 5).map((v) => `${v.name} (${v.lang})`), '...');
      } else {
        console.warn("âš ï¸ ë¸Œë¼ìš°ì € TTS ìŒì„±ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
      }
    } else {
      this.availableVoices = [];
      console.warn("âš ï¸ speechSynthesisë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
    }
    
    // ê¸°ë³¸ ìŒì„± ì„¤ì •
    if (!this.settings.browserVoice && this.availableVoices.length > 0) {
      const koreanVoice = this.availableVoices.find(
        (voice) => voice.lang.startsWith("ko")
      );
      this.settings.browserVoice = (koreanVoice == null ? void 0 : koreanVoice.name) || ((_a = this.availableVoices[0]) == null ? void 0 : _a.name) || "";
      console.log(`ğŸ¤ ì„ íƒëœ ìŒì„±: ${this.settings.browserVoice}`);
      await this.saveSettings();
    }
  }
  speakText(text) {
    this.stopSpeaking();
    const cleanText = this.cleanMarkdown(text);
    this.currentSpeakingText = cleanText;
    
    console.log("ğŸ“¢ ë¸Œë¼ìš°ì € TTSë¡œ í…ìŠ¤íŠ¸ ì½ê¸° ì‹œì‘");
    new import_obsidian.Notice("ğŸ”Š í…ìŠ¤íŠ¸ ì½ê¸° ì‹œì‘");
    this.speakWithBrowser(cleanText);
  }
  async speakWithCustomVoice(text) {
    try {
      new import_obsidian.Notice("\u{1F3AD} \uB0B4 \uBAA9\uC18C\uB9AC\uB85C \uC77D\uAE30 \uC2DC\uC791...");
      const base64Data = this.settings.customVoiceData;
      if (!base64Data) {
        throw new Error("\uC74C\uC131 \uD504\uB85C\uD544\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");
      }
      const response = await fetch(base64Data);
      const blob = await response.blob();
      const audioUrl = URL.createObjectURL(blob);
      this.currentAudio = new Audio(audioUrl);
      this.currentAudio.onplay = () => {
        this.isPlaying = true;
        new import_obsidian.Notice("\u{1F50A} \uC74C\uC131 \uC7AC\uC0DD \uC911...");
      };
      this.currentAudio.onended = async () => {
        this.isPlaying = false;
        URL.revokeObjectURL(audioUrl);
        this.currentAudio = null;
        new import_obsidian.Notice("\u2705 \uC7AC\uC0DD \uC644\uB8CC");
        if (this.settings.autoSaveAudio) {
          try {
            await this.saveTTSAsFile(text);
          } catch (error) {
            console.error("TTS \uC790\uB3D9 \uC800\uC7A5 \uC2E4\uD328:", error);
          }
        }
      };
      this.currentAudio.onerror = (error) => {
        console.error("Audio playback error:", error);
        this.isPlaying = false;
        URL.revokeObjectURL(audioUrl);
        this.currentAudio = null;
        new import_obsidian.Notice("\u274C \uC74C\uC131 \uC7AC\uC0DD \uC2E4\uD328. \uBE0C\uB77C\uC6B0\uC800 TTS\uB85C \uC804\uD658\uD569\uB2C8\uB2E4.");
        this.speakWithBrowser(text);
      };
      this.currentAudio.volume = this.settings.volume;
      await this.currentAudio.play();
      console.log("\uC7AC\uC0DD\uD560 \uD14D\uC2A4\uD2B8:", text.substring(0, 100) + "...");
      new import_obsidian.Notice(`\u{1F4DD} \uD14D\uC2A4\uD2B8 \uAE38\uC774: ${text.length}\uC790 (\uB179\uC74C\uB41C \uC0D8\uD50C \uC7AC\uC0DD)`);
    } catch (error) {
      console.error("Custom voice playback error:", error);
      new import_obsidian.Notice("\u274C \uB0B4 \uBAA9\uC18C\uB9AC \uC7AC\uC0DD \uC2E4\uD328: " + error.message + ". \uBE0C\uB77C\uC6B0\uC800 TTS\uB85C \uC804\uD658\uD569\uB2C8\uB2E4.");
      this.speakWithBrowser(text);
    }
  }
  
  async speakWithGoogleTTS(text) {
    try {
      console.log("ğŸŒ Google TTS ì‚¬ìš© (ëª¨ë°”ì¼ ìµœì í™”)");
      new import_obsidian.Notice("ğŸµ ìŒì„± ìƒì„± ì¤‘...");
      
      // ì–¸ì–´ ê°ì§€
      const lang = this.detectLanguage(text);
      console.log(`ê°ì§€ëœ ì–¸ì–´: ${lang}`);
      
      // í…ìŠ¤íŠ¸ ê¸¸ì´ ì œí•œ (200ì)
      const maxLength = 200;
      const textToSpeak = text.length > maxLength ? text.substring(0, maxLength) : text;
      const encodedText = encodeURIComponent(textToSpeak);
      
      console.log(`ì¬ìƒí•  í…ìŠ¤íŠ¸ (${textToSpeak.length}ì):`, textToSpeak.substring(0, 50) + '...');
      
      // Google Translate TTS - ì—¬ëŸ¬ URL ì‹œë„
      const urls = [
        `https://translate.google.com/translate_tts?ie=UTF-8&q=${encodedText}&tl=${lang}&client=tw-ob`,
        `https://translate.google.com/translate_tts?ie=UTF-8&q=${encodedText}&tl=${lang}&total=1&idx=0&textlen=${textToSpeak.length}&client=tw-ob`,
        `https://translate.google.com/translate_tts?ie=UTF-8&q=${encodedText}&tl=${lang}&client=gtx`
      ];
      
      // ì²« ë²ˆì§¸ URLë¡œ ì‹œë„
      const audioUrl = urls[0];
      console.log('ì˜¤ë””ì˜¤ URL:', audioUrl);
      
      // Fetchë¡œ ë¨¼ì € ë‹¤ìš´ë¡œë“œ ì‹œë„
      try {
        const response = await fetch(audioUrl, {
          method: 'GET',
          headers: {
            'User-Agent': 'Mozilla/5.0',
            'Referer': 'https://translate.google.com/'
          }
        });
        
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}`);
        }
        
        const blob = await response.blob();
        console.log('ì˜¤ë””ì˜¤ blob í¬ê¸°:', blob.size, 'bytes');
        
        if (blob.size === 0) {
          throw new Error('ë¹ˆ ì˜¤ë””ì˜¤ ë°ì´í„°');
        }
        
        const blobUrl = URL.createObjectURL(blob);
        
        this.currentAudio = new Audio(blobUrl);
        this.currentAudio.volume = this.settings.volume;
        
        this.currentAudio.onloadedmetadata = () => {
          console.log("âœ… ì˜¤ë””ì˜¤ ë¡œë“œë¨, ê¸¸ì´:", this.currentAudio.duration, "ì´ˆ");
        };
        
        this.currentAudio.onplay = () => {
          this.isPlaying = true;
          new import_obsidian.Notice("ğŸ”Š ì¬ìƒ ì¤‘...");
        };
        
        this.currentAudio.onended = () => {
          this.isPlaying = false;
          URL.revokeObjectURL(blobUrl);
          this.currentAudio = null;
          new import_obsidian.Notice("âœ… ì¬ìƒ ì™„ë£Œ");
        };
        
        this.currentAudio.onerror = (error) => {
          console.error("ì˜¤ë””ì˜¤ ì¬ìƒ ì˜¤ë¥˜:", error);
          this.isPlaying = false;
          URL.revokeObjectURL(blobUrl);
          this.currentAudio = null;
          new import_obsidian.Notice("âŒ ìŒì„± ì¬ìƒ ì‹¤íŒ¨");
        };
        
        await this.currentAudio.play();
        console.log("âœ… Google TTS ì¬ìƒ ì‹œì‘");
        
      } catch (fetchError) {
        console.error("Fetch ì‹¤íŒ¨, ì§ì ‘ URL ì‚¬ìš©:", fetchError);
        
        // Fetch ì‹¤íŒ¨ ì‹œ ì§ì ‘ Audio URL ì‚¬ìš©
        this.currentAudio = new Audio(audioUrl);
        this.currentAudio.crossOrigin = "anonymous";
        this.currentAudio.volume = this.settings.volume;
        
        this.currentAudio.onplay = () => {
          this.isPlaying = true;
          new import_obsidian.Notice("ğŸ”Š ì¬ìƒ ì¤‘...");
        };
        
        this.currentAudio.onended = () => {
          this.isPlaying = false;
          this.currentAudio = null;
          new import_obsidian.Notice("âœ… ì¬ìƒ ì™„ë£Œ");
        };
        
        this.currentAudio.onerror = (error) => {
          console.error("ì§ì ‘ ì¬ìƒë„ ì‹¤íŒ¨:", error);
          new import_obsidian.Notice("âŒ ìŒì„± ì¬ìƒ ë¶ˆê°€");
        };
        
        await this.currentAudio.play();
      }
      
    } catch (error) {
      console.error("Google TTS ì™„ì „ ì‹¤íŒ¨:", error);
      new import_obsidian.Notice("âŒ ìŒì„± ìƒì„± ì‹¤íŒ¨ - ë¸Œë¼ìš°ì € TTS ì‹œë„");
      // ìµœí›„ì˜ ìˆ˜ë‹¨: ë¸Œë¼ìš°ì € TTS
      this.speakWithBrowser(text);
    }
  }
  
  async speakWithEdgeTTS(text, voiceName) {
    try {
      console.log(`ğŸŒ Edge TTS WebSocketìœ¼ë¡œ ìŒì„± ìƒì„± ì¤‘... (${voiceName})`);
      console.log(`ğŸ“ í…ìŠ¤íŠ¸ ê¸¸ì´: ${text.length}ì`);
      new import_obsidian.Notice("ğŸµ Edge TTSë¡œ ìŒì„± ìƒì„± ì¤‘...");
      
      return new Promise((resolve, reject) => {
        const requestId = this.generateRequestId();
        const audioChunks = [];
        let hasReceivedAudio = false;
        
        // WebSocket ì—°ê²° - Edge TTS ì—”ë“œí¬ì¸íŠ¸
        const wsUrl = `wss://speech.platform.bing.com/consumer/speech/synthesize/readaloud/edge/v1?TrustedClientToken=6A5AA1D4EAFF4E9FB37E23D68491D6F4&ConnectionId=${requestId}`;
        console.log('ğŸ”Œ WebSocket ì—°ê²° ì‹œë„:', wsUrl);
        
        const ws = new WebSocket(wsUrl);
        ws.binaryType = 'arraybuffer';
        
        ws.onopen = () => {
          console.log("âœ… WebSocket ì—°ê²° ì„±ê³µ");
          
          const configMessage = `Content-Type:application/json; charset=utf-8\r
Path:speech.config\r
\r
{
  "context": {
    "synthesis": {
      "audio": {
        "metadataoptions": {
          "sentenceBoundaryEnabled": "false",
          "wordBoundaryEnabled": "false"
        },
        "outputFormat": "audio-24khz-48kbitrate-mono-mp3"
      }
    }
  }
}`;
          
          try {
            ws.send(configMessage);
            console.log("ğŸ“¤ ì„¤ì • ë©”ì‹œì§€ ì „ì†¡ ì™„ë£Œ");
          } catch (e) {
            console.error("âŒ ì„¤ì • ë©”ì‹œì§€ ì „ì†¡ ì‹¤íŒ¨:", e);
            reject(e);
            return;
          }
          
          // 2. SSML ë©”ì‹œì§€ ì „ì†¡
          const rate = `${(this.settings.speed - 1) * 100 >= 0 ? '+' : ''}${Math.round((this.settings.speed - 1) * 100)}%`;
          const pitch = `${(this.settings.pitch - 1) * 50 >= 0 ? '+' : ''}${Math.round((this.settings.pitch - 1) * 50)}Hz`;
          
          const ssml = `<speak version='1.0' xmlns='http://www.w3.org/2001/10/synthesis' xml:lang='ko-KR'>
  <voice name='${voiceName}'>
    <prosody rate='${rate}' pitch='${pitch}' volume='${Math.round(this.settings.volume * 100)}'>
      ${text.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;')}
    </prosody>
  </voice>
</speak>`;
          
          const ssmlMessage = `X-RequestId:${requestId}\r
Content-Type:application/ssml+xml\r
Path:ssml\r
\r
${ssml}`;

          
          try {
            ws.send(ssmlMessage);
            console.log("ğŸ“¤ SSML ì „ì†¡ ì™„ë£Œ");
          } catch (e) {
            console.error("âŒ SSML ì „ì†¡ ì‹¤íŒ¨:", e);
            reject(e);
          }
        };
        
        ws.onmessage = (event) => {
          if (typeof event.data === 'string') {
            // í…ìŠ¤íŠ¸ ë©”ì‹œì§€ (ë©”íƒ€ë°ì´í„°)
            console.log("ğŸ“¨ í…ìŠ¤íŠ¸ ë©”ì‹œì§€ ìˆ˜ì‹ :", event.data.substring(0, 100));
            
            if (event.data.includes('Path:turn.end')) {
              console.log("âœ… ì˜¤ë””ì˜¤ ìˆ˜ì‹  ì™„ë£Œ");
              ws.close();
              
              if (audioChunks.length === 0) {
                console.error("âŒ ì˜¤ë””ì˜¤ ë°ì´í„° ì—†ìŒ");
                new import_obsidian.Notice("âŒ ì˜¤ë””ì˜¤ ë°ì´í„°ë¥¼ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤");
                reject(new Error("ì˜¤ë””ì˜¤ ë°ì´í„°ë¥¼ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤"));
                return;
              }
              
              console.log(`ğŸ“Š ì´ ${audioChunks.length}ê°œì˜ ì˜¤ë””ì˜¤ ì²­í¬ ìˆ˜ì‹ ë¨`);
              
              // ì˜¤ë””ì˜¤ ë¸”ë¡­ ìƒì„± - ArrayBufferë¥¼ Uint8Arrayë¡œ ë³€í™˜
              const totalLength = audioChunks.reduce((sum, chunk) => sum + chunk.byteLength, 0);
              console.log(`ğŸ“ ì´ ì˜¤ë””ì˜¤ ê¸¸ì´: ${totalLength} bytes`);
              
              const audioData = new Uint8Array(totalLength);
              let offset = 0;
              for (const chunk of audioChunks) {
                audioData.set(new Uint8Array(chunk), offset);
                offset += chunk.byteLength;
              }
              
              const audioBlob = new Blob([audioData], { type: 'audio/mpeg' });
              console.log(`ğŸ“¦ ì˜¤ë””ì˜¤ ë¸”ë¡­ ìƒì„± ì™„ë£Œ: ${audioBlob.size} bytes`);
              
              this.playAudioBlob(audioBlob, text);
              resolve(true);
            }
          } else {
            // ë°”ì´ë„ˆë¦¬ ë©”ì‹œì§€ (ì˜¤ë””ì˜¤ ë°ì´í„°)
            const dataView = new DataView(event.data);
            
            // í—¤ë” íŒŒì‹± (ì²˜ìŒ 2ë°”ì´íŠ¸ëŠ” í—¤ë” ê¸¸ì´)
            const headerLength = dataView.getInt16(0, false);
            
            // ì˜¤ë””ì˜¤ ë°ì´í„°ëŠ” í—¤ë” ì´í›„ë¶€í„°
            const audioData = event.data.slice(2 + headerLength);
            
            if (audioData.byteLength > 0) {
              audioChunks.push(audioData);
              hasReceivedAudio = true;
              console.log(`ğŸ“¦ ì˜¤ë””ì˜¤ ì²­í¬ ìˆ˜ì‹ : ${audioData.byteLength} bytes (ì´ ${audioChunks.length}ê°œ)`);
            }
          }
        };
        
        ws.onerror = (error) => {
          console.warn("Edge TTS WebSocket ì—°ê²° ì‹¤íŒ¨ - ë¸Œë¼ìš°ì € TTS ì‚¬ìš©");
          ws.close();
          
          // ë¸Œë¼ìš°ì € TTSë¡œ í´ë°± (ì•Œë¦¼ ì—†ì´)
          this.speakWithBrowser(text);
          resolve(false);
        };
        
        ws.onclose = (event) => {
          console.log("WebSocket ì—°ê²° ì¢…ë£Œ (ì½”ë“œ: " + event.code + ")");
          
          // ì •ìƒ ì¢…ë£Œê°€ ì•„ë‹ˆê³  ì˜¤ë””ì˜¤ë„ ì—†ìœ¼ë©´ í´ë°±
          if (!event.wasClean && !hasReceivedAudio && audioChunks.length === 0) {
            console.warn("Edge TTS ì‚¬ìš© ë¶ˆê°€ - ë¸Œë¼ìš°ì € TTSë¡œ í´ë°±");
            this.speakWithBrowser(text);
            resolve(false);
          }
        };
        
        // íƒ€ì„ì•„ì›ƒ (30ì´ˆ)
        setTimeout(() => {
          if (ws.readyState !== WebSocket.CLOSED) {
            console.warn("â° WebSocket íƒ€ì„ì•„ì›ƒ (30ì´ˆ)");
            ws.close();
            reject(new Error('íƒ€ì„ì•„ì›ƒ'));
          }
        }, 30000);
      });
      
    } catch (error) {
      console.warn("Edge TTS ì‹¤íŒ¨ - ë¸Œë¼ìš°ì € TTS ì‚¬ìš©:", error.message);
      
      // ì—ëŸ¬ ë°œìƒ ì‹œ ë¸Œë¼ìš°ì € TTSë¡œ í´ë°± (ì•Œë¦¼ ì—†ì´)
      this.speakWithBrowser(text);
      return false;
    }
  }
  
  generateRequestId() {
    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, (c) => {
      const r = Math.random() * 16 | 0;
      const v = c === 'x' ? r : (r & 0x3 | 0x8);
      return v.toString(16);
    });
  }
  
  playAudioBlob(audioBlob, text) {
    console.log(`ğŸµ playAudioBlob í˜¸ì¶œë¨: ${audioBlob.size} bytes`);
    
    if (audioBlob.size === 0) {
      console.error("âŒ ì˜¤ë””ì˜¤ ë¸”ë¡­ì´ ë¹„ì–´ìˆìŒ");
      new import_obsidian.Notice("âŒ ì˜¤ë””ì˜¤ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤");
      return;
    }
    
    const audioUrl = URL.createObjectURL(audioBlob);
    console.log("ğŸ”— ì˜¤ë””ì˜¤ URL ìƒì„±:", audioUrl);
    
    this.currentAudio = new Audio(audioUrl);
    this.currentAudio.volume = this.settings.volume;
    
    console.log(`ğŸ”Š ë³¼ë¥¨ ì„¤ì •: ${this.settings.volume}`);
    
    this.currentAudio.onloadedmetadata = () => {
      console.log(`âœ… ì˜¤ë””ì˜¤ ë©”íƒ€ë°ì´í„° ë¡œë“œë¨ - ê¸¸ì´: ${this.currentAudio.duration}ì´ˆ`);
    };
    
    this.currentAudio.oncanplaythrough = () => {
      console.log("âœ… ì˜¤ë””ì˜¤ ì¬ìƒ ì¤€ë¹„ ì™„ë£Œ");
    };
    
    this.currentAudio.onplay = () => {
      this.isPlaying = true;
      new import_obsidian.Notice("ğŸ”Š Edge TTS ìŒì„± ì¬ìƒ ì¤‘...");
      console.log("â–¶ï¸ Edge TTS ì¬ìƒ ì‹œì‘");
    };
    
    this.currentAudio.onended = () => {
      this.isPlaying = false;
      URL.revokeObjectURL(audioUrl);
      this.currentAudio = null;
      new import_obsidian.Notice("âœ… ìŒì„± ì½ê¸° ì™„ë£Œ");
      console.log("â¹ï¸ Edge TTS ì¬ìƒ ì¢…ë£Œ");
    };
    
    this.currentAudio.onerror = (error) => {
      console.error("âŒ Edge TTS ì¬ìƒ ì‹¤íŒ¨:", error);
      console.error("ì˜¤ë””ì˜¤ ì—ëŸ¬ ìƒì„¸:", {
        code: this.currentAudio.error?.code,
        message: this.currentAudio.error?.message
      });
      this.isPlaying = false;
      URL.revokeObjectURL(audioUrl);
      this.currentAudio = null;
      new import_obsidian.Notice("âŒ ìŒì„± ì¬ìƒ ì˜¤ë¥˜");
    };
    
    // ì¬ìƒ ì‹œë„
    console.log("â–¶ï¸ ì¬ìƒ ì‹œë„...");
    this.currentAudio.play().then(() => {
      console.log("âœ… play() Promise ì„±ê³µ");
    }).catch(err => {
      console.error("âŒ play() Promise ì‹¤íŒ¨:", err);
      console.error("ì—ëŸ¬ ìƒì„¸:", {
        name: err.name,
        message: err.message,
        code: err.code
      });
      new import_obsidian.Notice("âŒ ìŒì„± ì¬ìƒ ì‹¤íŒ¨: " + err.message);
    });
  }
  
  async speakWithBrowser(text) {
    var _a;
    
    console.log("=" .repeat(60));
    console.log("ï¿½ speakWithBrowser í˜¸ì¶œë¨");
    console.log("ğŸ“ í…ìŠ¤íŠ¸:", text);
    console.log("=" .repeat(60));
    
    // Edge TTSëŠ” ì¼ë‹¨ ê±´ë„ˆë›°ê³  ë¸Œë¼ìš°ì € TTSë§Œ í…ŒìŠ¤íŠ¸
    // (Edge TTS ë¬¸ì œì¸ì§€ ë¸Œë¼ìš°ì € TTS ë¬¸ì œì¸ì§€ í™•ì¸ìš©)
    console.log("âš ï¸ Edge TTS ê±´ë„ˆë›°ê¸° (í…ŒìŠ¤íŠ¸ ëª¨ë“œ)");
    
    // ë¸Œë¼ìš°ì € TTS í´ë°±
    if (!this.synthesis) {
      console.error("âŒ speechSynthesisê°€ ì—†ìŠµë‹ˆë‹¤.");
      new import_obsidian.Notice("âš ï¸ ë¸Œë¼ìš°ì € TTS ê¸°ëŠ¥ì´ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤");
      return;
    }
    
    console.log("âœ… speechSynthesis ì‚¬ìš© ê°€ëŠ¥");
    console.log("ğŸ” synthesis ìƒíƒœ:", {
      paused: this.synthesis.paused,
      pending: this.synthesis.pending,
      speaking: this.synthesis.speaking
    });
    
    console.log("âœ… speechSynthesis ì‚¬ìš© ê°€ëŠ¥");
    console.log("ğŸ” synthesis ìƒíƒœ:", {
      paused: this.synthesis.paused,
      pending: this.synthesis.pending,
      speaking: this.synthesis.speaking
    });
    
    console.log("ğŸ¤ ë¸Œë¼ìš°ì € TTS ì¬ìƒ ì‹œì‘...");
    console.log("ğŸ“ í…ìŠ¤íŠ¸ ê¸¸ì´:", text.length);
    
    // ë¸Œë¼ìš°ì € ìŒì„± ëª©ë¡ì´ ë¹„ì–´ìˆìœ¼ë©´ ì¬ë¡œë“œ ì‹œë„
    if (this.browserVoices.length === 0) {
      console.log("âš ï¸ ë¸Œë¼ìš°ì € ìŒì„± ëª©ë¡ì´ ë¹„ì–´ìˆìŒ. ì¬ë¡œë“œ ì‹œë„...");
      let voices = this.synthesis.getVoices();
      console.log(`ğŸ“Š getVoices() ê²°ê³¼: ${voices.length}ê°œ`);
      
      if (voices.length > 0) {
        this.browserVoices = voices;
        console.log(`âœ… ë¸Œë¼ìš°ì € ìŒì„± ì¬ë¡œë“œ ì„±ê³µ: ${voices.length}ê°œ`);
        voices.slice(0, 3).forEach(v => {
          console.log(`  - ${v.name} (${v.lang})`);
        });
      } else {
        console.warn("âŒ ë¸Œë¼ìš°ì € ìŒì„± ë¡œë“œ ì‹¤íŒ¨.");
        console.warn("âš ï¸ ê¸°ë³¸ ìŒì„±ìœ¼ë¡œ ì¬ìƒì„ ì‹œë„í•©ë‹ˆë‹¤...");
        new import_obsidian.Notice("âš ï¸ ìŒì„± ëª©ë¡ì´ ì—†ìŠµë‹ˆë‹¤. ê¸°ë³¸ ìŒì„±ìœ¼ë¡œ ì¬ìƒí•©ë‹ˆë‹¤.");
      }
    } else {
      console.log(`âœ… ë¸Œë¼ìš°ì € ìŒì„± ${this.browserVoices.length}ê°œ ì‚¬ìš© ê°€ëŠ¥`);
    }
    
    const utterance = new SpeechSynthesisUtterance(text);
    
    // ë¸Œë¼ìš°ì € ìŒì„± ì¤‘ì—ì„œ ì„ íƒëœ ìŒì„± ì°¾ê¸°
    const voice = this.browserVoices.find((v) => v.name === this.settings.browserVoice);
    if (voice) {
      utterance.voice = voice;
      console.log(`ğŸ¤ ì‚¬ìš© ìŒì„±: ${voice.name} (${voice.lang})`);
    } else if (this.browserVoices.length > 0) {
      // ì„ íƒëœ ìŒì„±ì´ ì—†ìœ¼ë©´ í•œêµ­ì–´ ìŒì„± ì°¾ê¸°
      const koreanVoice = this.browserVoices.find((v) => v.lang.startsWith('ko'));
      if (koreanVoice) {
        utterance.voice = koreanVoice;
        console.log(`ğŸ¤ í•œêµ­ì–´ ê¸°ë³¸ ìŒì„± ì‚¬ìš©: ${koreanVoice.name}`);
      } else {
        utterance.voice = this.browserVoices[0];
        console.log(`ğŸ¤ ì²« ë²ˆì§¸ ìŒì„± ì‚¬ìš©: ${this.browserVoices[0].name}`);
      }
    } else {
      console.warn("âš ï¸ ì‚¬ìš© ê°€ëŠ¥í•œ ë¸Œë¼ìš°ì € ìŒì„±ì´ ì—†ìŠµë‹ˆë‹¤. ì‹œìŠ¤í…œ ê¸°ë³¸ê°’ìœ¼ë¡œ ì¬ìƒí•©ë‹ˆë‹¤.");
    }
    
    utterance.rate = this.settings.speed;
    utterance.pitch = this.settings.pitch;
    utterance.volume = this.settings.volume;
    utterance.lang = this.settings.language;
    
    console.log("âš™ï¸ TTS ì„¤ì •:", {
      voice: ((_a = utterance.voice) == null ? void 0 : _a.name) || "system default",
      rate: utterance.rate,
      pitch: utterance.pitch,
      volume: utterance.volume,
      lang: utterance.lang
    });
    
    utterance.onstart = () => {
      console.log("â–¶ï¸ ë¸Œë¼ìš°ì € TTS ì¬ìƒ ì‹œì‘ë¨");
      console.log("ğŸ¤ ì‹¤ì œ ì‚¬ìš©ëœ ìŒì„±:", utterance.voice?.name || "ê¸°ë³¸ ìŒì„±");
      this.isPlaying = true;
      new import_obsidian.Notice("ğŸ”Š ìŒì„± ì½ê¸° ì‹œì‘");
    };
    
    utterance.onend = async () => {
      console.log("â¹ï¸ ë¸Œë¼ìš°ì € TTS ì¬ìƒ ì¢…ë£Œë¨");
      this.isPlaying = false;
      this.currentUtterance = null;
      new import_obsidian.Notice("âœ… ìŒì„± ì½ê¸° ì™„ë£Œ");
      if (this.settings.autoSaveAudio) {
        try {
          await this.saveTTSAsFile(text);
        } catch (error) {
          console.error("TTS ìë™ ì €ì¥ ì‹¤íŒ¨:", error);
        }
      }
    };
    utterance.onerror = (event) => {
      console.error("\u274C TTS \uC624\uB958 \uBC1C\uC0DD:", event);
      console.error("\uC624\uB958 \uC0C1\uC138:", {
        error: event.error,
        charIndex: event.charIndex,
        elapsedTime: event.elapsedTime
      });
      this.isPlaying = false;
      this.currentUtterance = null;
      new import_obsidian.Notice("\u274C \uC74C\uC131 \uC77D\uAE30 \uC624\uB958: " + event.error);
    };
    this.currentUtterance = utterance;
    
    console.log("ğŸ” ì¬ìƒ ì§ì „ ìƒíƒœ:", {
      isPaused: this.synthesis.paused,
      isPending: this.synthesis.pending,
      isSpeaking: this.synthesis.speaking
    });
    
    // ì´ì „ ì¬ìƒ ì™„ì „íˆ ì •ë¦¬
    this.synthesis.cancel();
    
    // ì¬ìƒ ì‹œì‘ ì „ ì•½ê°„ì˜ ì§€ì—° (ë¸Œë¼ìš°ì € ì´ˆê¸°í™” ëŒ€ê¸°)
    await new Promise(resolve => setTimeout(resolve, 50));
    
    console.log("â–¶ï¸ synthesis.speak() í˜¸ì¶œ...");
    this.synthesis.speak(utterance);
    
    // ì¬ìƒ ì‹œì‘ í™•ì¸
    setTimeout(() => {
      console.log("ğŸ” ì¬ìƒ ì‹œì‘ í›„ ìƒíƒœ (100ms):", {
        isPaused: this.synthesis.paused,
        isPending: this.synthesis.pending,
        isSpeaking: this.synthesis.speaking,
        isPlayingFlag: this.isPlaying
      });
      
      // ì¬ìƒì´ ì‹œì‘ë˜ì§€ ì•Šì•˜ë‹¤ë©´ ê²½ê³ 
      if (!this.synthesis.speaking && !this.synthesis.pending) {
        console.error("âŒ TTS ì¬ìƒì´ ì‹œì‘ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!");
        new import_obsidian.Notice("âŒ TTS ì¬ìƒ ì‹¤íŒ¨. ì½˜ì†”ì„ í™•ì¸í•˜ì„¸ìš”.");
      }
    }, 100);
  }
  async saveTTSAsFile(text) {
    try {
      const folderPath = this.settings.outputFolder;
      const folder = this.app.vault.getAbstractFileByPath(folderPath);
      if (!folder) {
        await this.app.vault.createFolder(folderPath);
      }
      const timestamp = new Date().toISOString().replace(/[:.]/g, "-").slice(0, -5);
      const filename = `tts_${timestamp}.txt`;
      const filePath = `${folderPath}/${filename}`;
      const content = `# TTS \uC74C\uC131 \uD14D\uC2A4\uD2B8

\uC0DD\uC131: ${new Date().toLocaleString("ko-KR")}
\uC74C\uC131 \uBAA8\uB4DC: ${this.settings.voiceMode}
\uC5B8\uC5B4: ${this.settings.language}

---

${text}`;
      await this.app.vault.create(filePath, content);
      new import_obsidian.Notice(`\u2705 TTS \uD14D\uC2A4\uD2B8 \uC800\uC7A5: ${filename}`);
      if (this.settings.voiceMode === "custom" && this.settings.customVoiceData) {
        try {
          const response = await fetch(this.settings.customVoiceData);
          const blob = await response.blob();
          await this.saveAudioFile(blob, `tts_${timestamp}`);
        } catch (error) {
          console.error("\uC624\uB514\uC624 \uD30C\uC77C \uC800\uC7A5 \uC2E4\uD328:", error);
        }
      }
    } catch (error) {
      console.error("TTS \uD30C\uC77C \uC800\uC7A5 \uC2E4\uD328:", error);
      throw error;
    }
  }
  async stopSpeaking() {
    if (this.settings.autoSaveAudio && this.currentSpeakingText && (this.synthesis.speaking || this.currentAudio)) {
      try {
        await this.saveTTSAsFile(this.currentSpeakingText);
      } catch (error) {
        console.error("\uC911\uC9C0 \uC2DC \uC790\uB3D9 \uC800\uC7A5 \uC2E4\uD328:", error);
      }
    }
    if (this.synthesis.speaking) {
      this.synthesis.cancel();
      this.isPlaying = false;
      this.currentUtterance = null;
    }
    if (this.currentAudio) {
      this.currentAudio.pause();
      this.currentAudio.currentTime = 0;
      const audioUrl = this.currentAudio.src;
      if (audioUrl.startsWith("blob:")) {
        URL.revokeObjectURL(audioUrl);
      }
      this.currentAudio = null;
      this.isPlaying = false;
    }
    this.currentSpeakingText = "";
    new import_obsidian.Notice("\u23F9\uFE0F \uC74C\uC131 \uC77D\uAE30 \uC815\uC9C0");
  }
  togglePause() {
    if (this.currentAudio) {
      if (this.currentAudio.paused) {
        this.currentAudio.play();
        new import_obsidian.Notice("\u25B6\uFE0F \uC7AC\uAC1C");
      } else {
        this.currentAudio.pause();
        new import_obsidian.Notice("\u23F8\uFE0F \uC77C\uC2DC\uC815\uC9C0");
      }
      return;
    }
    if (this.synthesis.speaking) {
      if (this.synthesis.paused) {
        this.synthesis.resume();
        new import_obsidian.Notice("\u25B6\uFE0F \uC7AC\uAC1C");
      } else {
        this.synthesis.pause();
        new import_obsidian.Notice("\u23F8\uFE0F \uC77C\uC2DC\uC815\uC9C0");
      }
    }
  }
  // TXT íŒŒì¼ ë‚´ìš© ì¶”ì¶œ (ë©”íƒ€ë°ì´í„° ì œê±°)
  extractTextFromTTSFile(content) {
    const lines = content.split("\n");
    let textStart = -1;
    for (let i = 0; i < lines.length; i++) {
      if (lines[i].trim() === "---") {
        textStart = i + 1;
        break;
      }
    }
    if (textStart === -1) {
      return content.trim();
    }
    const textContent = lines.slice(textStart).join("\n").trim();
    return textContent;
  }
  // í”Œë«í¼ ê²€ì‚¬ ìœ í‹¸ë¦¬í‹°
  isElectronApp() {
    try {
      const ua = navigator.userAgent || "";
      if (ua.includes("Electron"))
        return true;
      if (typeof window.require === "function") {
        return true;
      }
    } catch (e) {
    }
    return false;
  }
  isMobileApp() {
    try {
      const ua = navigator.userAgent || "";
      return /Android|iPhone|iPad|iPod/.test(ua) && !ua.includes("Electron");
    } catch (e) {
      return false;
    }
  }
  // í˜„ì¬ ì—´ë¦° TXT íŒŒì¼ ì½ê¸°
  async readCurrentTxtFile(view) {
    const file = view.file;
    if (!file) {
      new import_obsidian.Notice("\uD30C\uC77C\uC774 \uC5F4\uB824\uC788\uC9C0 \uC54A\uC2B5\uB2C8\uB2E4");
      return;
    }
    if (file.extension !== "txt") {
      new import_obsidian.Notice("TXT \uD30C\uC77C\uB9CC \uC77D\uC744 \uC218 \uC788\uC2B5\uB2C8\uB2E4");
      return;
    }
    const content = await this.app.vault.read(file);
    const textContent = this.extractTextFromTTSFile(content);
    if (textContent) {
      new import_obsidian.Notice(`\u{1F4D6} "${file.basename}" \uD30C\uC77C\uC744 \uC77D\uC2B5\uB2C8\uB2E4`);
      this.speakText(textContent);
    } else {
      new import_obsidian.Notice("\uC77D\uC744 \uB0B4\uC6A9\uC774 \uC5C6\uC2B5\uB2C8\uB2E4");
    }
  }
  cleanMarkdown(text) {
    return text.replace(/^#+\s+/gm, "").replace(/\*\*(.+?)\*\*/g, "$1").replace(/\*(.+?)\*/g, "$1").replace(/~~(.+?)~~/g, "$1").replace(/\[(.+?)\]\(.+?\)/g, "$1").replace(/!\[.*?\]\(.+?\)/g, "").replace(/```[\s\S]*?```/g, "").replace(/`(.+?)`/g, "$1").replace(/^\s*[-*+]\s+/gm, "").replace(/^\s*\d+\.\s+/gm, "").replace(/^\s*>\s+/gm, "").replace(/---+/g, "").trim();
  }
  async startRecording() {
    try {
      if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
        throw new Error("\uC774 \uBE0C\uB77C\uC6B0\uC800\uB294 \uC624\uB514\uC624 \uB179\uC74C\uC744 \uC9C0\uC6D0\uD558\uC9C0 \uC54A\uC2B5\uB2C8\uB2E4.");
      }
      new import_obsidian.Notice("\u{1F399}\uFE0F \uB9C8\uC774\uD06C \uC811\uADFC \uAD8C\uD55C\uC744 \uC694\uCCAD\uD569\uB2C8\uB2E4...");
      const stream = await navigator.mediaDevices.getUserMedia({
        audio: {
          echoCancellation: true,
          noiseSuppression: true,
          sampleRate: 44100
        }
      });
      this.recordedChunks = [];
      if (!window.MediaRecorder) {
        throw new Error("\uC774 \uBE0C\uB77C\uC6B0\uC800\uB294 MediaRecorder\uB97C \uC9C0\uC6D0\uD558\uC9C0 \uC54A\uC2B5\uB2C8\uB2E4.");
      }
      let mimeType = "audio/webm;codecs=opus";
      if (!MediaRecorder.isTypeSupported(mimeType)) {
        mimeType = "audio/webm";
      }
      if (!MediaRecorder.isTypeSupported(mimeType)) {
        mimeType = "audio/ogg;codecs=opus";
      }
      if (!MediaRecorder.isTypeSupported(mimeType)) {
        mimeType = "audio/ogg";
      }
      if (!MediaRecorder.isTypeSupported(mimeType)) {
        mimeType = "audio/mp4";
      }
      if (!MediaRecorder.isTypeSupported(mimeType)) {
        mimeType = "";
      }
      console.log("Using MIME type for recording:", mimeType || "default");
      const options = mimeType ? { mimeType } : {};
      this.mediaRecorder = new MediaRecorder(stream, options);
      this.mediaRecorder.ondataavailable = (event) => {
        if (event.data.size > 0) {
          this.recordedChunks.push(event.data);
          console.log("Recording chunk received:", event.data.size, "bytes");
        }
      };
      this.mediaRecorder.onerror = (event) => {
        console.error("MediaRecorder error:", event.error);
        new import_obsidian.Notice("\u274C \uB179\uC74C \uC911 \uC624\uB958 \uBC1C\uC0DD: " + event.error);
      };
      this.mediaRecorder.start(100);
      console.log("MediaRecorder started, state:", this.mediaRecorder.state);
      new import_obsidian.Notice("\u{1F399}\uFE0F \uB179\uC74C \uC2DC\uC791\uB428");
    } catch (error) {
      console.error("Recording start error:", error);
      new import_obsidian.Notice("\u274C \uB9C8\uC774\uD06C \uC811\uADFC \uC2E4\uD328: " + error.message);
      throw error;
    }
  }
  async stopRecording() {
    return new Promise((resolve) => {
      if (!this.mediaRecorder) {
        console.warn("No MediaRecorder to stop");
        resolve(null);
        return;
      }
      if (this.mediaRecorder.state === "inactive") {
        console.warn("MediaRecorder already stopped");
        resolve(null);
        return;
      }
      this.mediaRecorder.onstop = () => {
        var _a, _b;
        console.log("MediaRecorder stopped, chunks:", this.recordedChunks.length);
        if (this.recordedChunks.length === 0) {
          new import_obsidian.Notice("\u274C \uB179\uC74C\uB41C \uB370\uC774\uD130\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4");
          resolve(null);
          return;
        }
        const mimeType = ((_a = this.mediaRecorder) == null ? void 0 : _a.mimeType) || "audio/webm";
        const blob = new Blob(this.recordedChunks, { type: mimeType });
        console.log("Audio blob created:", blob.size, "bytes, type:", blob.type);
        this.recordedChunks = [];
        (_b = this.mediaRecorder) == null ? void 0 : _b.stream.getTracks().forEach((track) => {
          track.stop();
          console.log("Track stopped:", track.kind);
        });
        this.mediaRecorder = null;
        new import_obsidian.Notice("\u23F9\uFE0F \uB179\uC74C \uC644\uB8CC (" + Math.round(blob.size / 1024) + "KB)");
        resolve(blob);
      };
      this.mediaRecorder.stop();
      console.log("Stopping MediaRecorder...");
    });
  }
  async saveAudioFile(audioBlob, fileName) {
    try {
      const folderPath = this.settings.audioFolder;
      const folder = this.app.vault.getAbstractFileByPath(folderPath);
      if (!folder) {
        await this.app.vault.createFolder(folderPath);
      }
      const arrayBuffer = await audioBlob.arrayBuffer();
      const timestamp = new Date().toISOString().replace(/[:.]/g, "-").slice(0, -5);
      const baseFileName = fileName.includes(".") ? fileName.split(".")[0] : fileName;
      const extension = fileName.includes(".") ? fileName.split(".").pop() : "webm";
      const filePath = `${folderPath}/${baseFileName}_${timestamp}.${extension}`;
      await this.app.vault.createBinary(filePath, arrayBuffer);
      console.log("Audio file saved:", filePath, arrayBuffer.byteLength, "bytes");
      new import_obsidian.Notice(`\u2705 \uC74C\uC131 \uD30C\uC77C \uC800\uC7A5: ${filePath}`);
      return filePath;
    } catch (error) {
      new import_obsidian.Notice("\u274C \uD30C\uC77C \uC800\uC7A5 \uC2E4\uD328: " + error.message);
    }
  }
  async createDashboard() {
    try {
      const dashboardFolder = this.settings.dashboardFolder;
      const audioFolder = this.settings.outputFolder;
      if (!this.app.vault.getAbstractFileByPath(dashboardFolder)) {
        await this.app.vault.createFolder(dashboardFolder);
      }
      const dashboardPath = `${dashboardFolder}/TTS \uD1B5\uD569 \uB300\uC2DC\uBCF4\uB4DC.md`;
      const dashboardContent = this.generateDashboardContent();
      const existingFile = this.app.vault.getAbstractFileByPath(dashboardPath);
      if (existingFile) {
        await this.app.vault.modify(existingFile, dashboardContent);
        new import_obsidian.Notice("\u2705 TTS \uB300\uC2DC\uBCF4\uB4DC \uC5C5\uB370\uC774\uD2B8 \uC644\uB8CC");
      } else {
        await this.app.vault.create(dashboardPath, dashboardContent);
        new import_obsidian.Notice("\u2705 TTS \uB300\uC2DC\uBCF4\uB4DC \uC0DD\uC131 \uC644\uB8CC");
      }
      const file = this.app.vault.getAbstractFileByPath(dashboardPath);
      if (file) {
        await this.app.workspace.openLinkText(dashboardPath, "", false);
      }
    } catch (error) {
      new import_obsidian.Notice("\u274C \uB300\uC2DC\uBCF4\uB4DC \uC0DD\uC131 \uC2E4\uD328: " + error.message);
      console.error("Dashboard creation error:", error);
    }
  }
  generateDashboardContent() {
    const now = new Date();
    const dateStr = now.toISOString().split("T")[0];
    return `---
title: TTS \uD1B5\uD569 \uB300\uC2DC\uBCF4\uB4DC
created: ${dateStr}
tags: [tts, dashboard, audio]
---

# \u{1F399}\uFE0F TTS \uD1B5\uD569 \uB300\uC2DC\uBCF4\uB4DC

> \uB9C8\uC9C0\uB9C9 \uC5C5\uB370\uC774\uD2B8: ${now.toLocaleString("ko-KR")}

## \u{1F3AF} \uBE60\uB978 \uC2E4\uD589

\`\`\`button
name \uFFFD \uC0C8 \uD14D\uC2A4\uD2B8 \uC77D\uAE30
type command
action TTS \uC74C\uC131 \uC77D\uAE30
color blue
\`\`\`
^button-new-tts

\`\`\`button
name \u{1F399}\uFE0F \uC74C\uC131 \uB179\uC74C
type command
action \uB0B4 \uC74C\uC131 \uB179\uC74C\uD558\uAE30
color green
\`\`\`
^button-record

\`\`\`button
name \u23F9\uFE0F \uC74C\uC131 \uC815\uC9C0
type command
action \uC74C\uC131 \uC77D\uAE30 \uC815\uC9C0
color red
\`\`\`
^button-stop

\`\`\`button
name \u23F8\uFE0F \uC77C\uC2DC\uC815\uC9C0/\uC7AC\uAC1C
type command
action \uC74C\uC131 \uC77D\uAE30 \uC77C\uC2DC\uC815\uC9C0/\uC7AC\uAC1C
color default
\`\`\`
^button-pause

\`\`\`button
name \u{1F504} \uB300\uC2DC\uBCF4\uB4DC \uC0C8\uB85C\uACE0\uCE68
type command
action TTS \uB300\uC2DC\uBCF4\uB4DC \uC0DD\uC131
color purple
\`\`\`
^button-refresh

---

## \uFFFD\u{1F4CA} \uD1B5\uACC4 \uC694\uC57D

\`\`\`dataviewjs
const audioFolder = "${this.settings.outputFolder}";
const txtFiles = dv.pages('"' + audioFolder + '"').where(p => p.file.name.endsWith('.txt'));
const audioFiles = dv.pages('"' + audioFolder + '"').where(p => p.file.name.endsWith('.webm') || p.file.name.endsWith('.mp4') || p.file.name.endsWith('.ogg'));

const totalTxt = txtFiles.length;
const totalAudio = audioFiles.length;
const voiceProfiles = audioFiles.where(f => f.file.name.includes('voice_profile')).length;

dv.paragraph(\`
\u{1F4C4} **\uC800\uC7A5\uB41C TTS \uD14D\uC2A4\uD2B8**: \${totalTxt}\uAC1C  
\u{1F3B5} **\uC624\uB514\uC624 \uD30C\uC77C**: \${totalAudio}\uAC1C  
\u{1F3AD} **\uC74C\uC131 \uD504\uB85C\uD544**: \${voiceProfiles}\uAC1C
\`);
\`\`\`

---

## \u{1F4C4} \uC800\uC7A5\uB41C TTS \uD14D\uC2A4\uD2B8 \uD30C\uC77C

> \u{1F4A1} **\uD30C\uC77C\uBA85\uC744 \uD074\uB9AD\uD558\uBA74 \uB0B4\uC6A9\uC744 \uC77D\uC5B4\uC90D\uB2C8\uB2E4**

\`\`\`dataviewjs
const audioFolder = "${this.settings.outputFolder}";
const txtFiles = dv.pages('"' + audioFolder + '"')
    .where(p => p.file.name.endsWith('.txt'))
    .sort(p => p.file.ctime, 'desc');

if (txtFiles.length === 0) {
    dv.paragraph('\u274C \uC800\uC7A5\uB41C TTS \uD14D\uC2A4\uD2B8 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4.');
    dv.paragraph('\u{1F4A1} \uC790\uB3D9 \uC800\uC7A5 \uAE30\uB2A5\uC744 \uD65C\uC131\uD654\uD558\uBA74 TTS\uB85C \uC77D\uC740 \uD14D\uC2A4\uD2B8\uAC00 \uC790\uB3D9\uC73C\uB85C \uC800\uC7A5\uB429\uB2C8\uB2E4.');
} else {
    dv.table(
        ['#', '\uD30C\uC77C\uBA85', '\uC0DD\uC131\uC77C', '\uD06C\uAE30', '\u{1F4D6} \uC77D\uAE30'],
        txtFiles.map((p, idx) => {
            const fileName = p.file.name.replace('.txt', '');
            const filePath = p.file.path;
            return [
                idx + 1,
                fileName,
                p.file.ctime ? new Date(p.file.ctime).toLocaleString('ko-KR', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                }) : 'N/A',
                p.file.size ? (p.file.size / 1024).toFixed(1) + ' KB' : 'N/A',
                '[\`\u25B6\uFE0F \uC7AC\uC0DD\`](' + filePath + ')'
            ];
        })
    );
    
    dv.paragraph('');
    dv.paragraph('**\uC0AC\uC6A9\uBC95**: \u{1F4D6} \uC77D\uAE30 \uC5F4\uC758 \`\u25B6\uFE0F \uC7AC\uC0DD\` \uB9C1\uD06C\uB97C \uD074\uB9AD\uD558\uBA74 \uD30C\uC77C \uB0B4\uC6A9\uC774 TTS\uB85C \uC7AC\uC0DD\uB429\uB2C8\uB2E4.');
}
\`\`\`

---

## \u{1F4C2} \uD3F4\uB354\uBCC4 \uD30C\uC77C \uBAA9\uB85D

\`\`\`dataviewjs
const baseFolder = "${this.settings.outputFolder}";
const allFiles = dv.pages('"' + baseFolder + '"');

// \uD3F4\uB354\uBCC4\uB85C \uADF8\uB8F9\uD654
const folders = {};
for (const page of allFiles) {
    const pathParts = page.file.folder.split('/');
    const folderName = pathParts[pathParts.length - 1] || baseFolder;
    
    if (!folders[folderName]) {
        folders[folderName] = [];
    }
    folders[folderName].push(page);
}

// \uAC01 \uD3F4\uB354\uBCC4 \uD14C\uC774\uBE14 \uC0DD\uC131
for (const [folderName, files] of Object.entries(folders)) {
    if (files.length === 0) continue;
    
    dv.header(3, \`\u{1F4C2} \${folderName} (\${files.length}\uAC1C)\`);
    
    dv.table(
        ['\uD30C\uC77C\uBA85', '\uC720\uD615', '\uC0DD\uC131\uC77C', '\uD06C\uAE30', '\uB9C1\uD06C'],
        files.map(p => {
            let fileType = '\u{1F4C4} \uAE30\uD0C0';
            if (p.file.name.endsWith('.txt')) fileType = '\uFFFD \uD14D\uC2A4\uD2B8';
            else if (p.file.name.endsWith('.webm') || p.file.name.endsWith('.mp4')) fileType = '\u{1F3B5} \uC624\uB514\uC624';
            else if (p.file.name.includes('voice_profile')) fileType = '\u{1F3AD} \uD504\uB85C\uD544';
            
            return [
                p.file.name,
                fileType,
                p.file.ctime ? new Date(p.file.ctime).toLocaleString('ko-KR') : 'N/A',
                p.file.size ? (p.file.size / 1024).toFixed(1) + ' KB' : 'N/A',
                dv.fileLink(p.file.path, false, '\u{1F517}')
            ];
        })
    );
}
\`\`\`

---

## \u{1F4C5} \uCD5C\uADFC \uD65C\uB3D9 (\uCD5C\uADFC 15\uAC1C)

\`\`\`dataviewjs
const audioFolder = "${this.settings.outputFolder}";
const recentFiles = dv.pages('"' + audioFolder + '"')
    .sort(p => p.file.ctime, 'desc')
    .limit(15);

if (recentFiles.length === 0) {
    dv.paragraph('\u274C \uCD5C\uADFC \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4.');
} else {
    dv.table(
        ['#', '\uD30C\uC77C\uBA85', '\uC720\uD615', '\uC0DD\uC131\uC77C', '\uB3D9\uC791'],
        recentFiles.map((p, idx) => {
            let fileType = '\u{1F4C4}';
            let action = dv.fileLink(p.file.path, false, '\u{1F517} \uC5F4\uAE30');
            
            if (p.file.name.endsWith('.txt')) {
                fileType = '\u{1F4DD} TXT';
                action = '[\`\u25B6\uFE0F \uC7AC\uC0DD\`](' + p.file.path + ')';
            } else if (p.file.name.endsWith('.webm') || p.file.name.endsWith('.mp4')) {
                fileType = '\u{1F3B5} Audio';
            } else if (p.file.name.includes('voice_profile')) {
                fileType = '\u{1F3AD} Profile';
            }
            
            return [
                idx + 1,
                p.file.name,
                fileType,
                p.file.ctime ? new Date(p.file.ctime).toLocaleString('ko-KR', {
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                }) : 'N/A',
                action
            ];
        })
    );
}
\`\`\`

---

## \u2699\uFE0F \uD604\uC7AC \uC124\uC815

\`\`\`dataviewjs
dv.paragraph(\`
**\u{1F3B5} \uC74C\uC131 \uBAA8\uB4DC**: ${this.settings.voiceMode === "browser" ? "\u{1F310} \uBE0C\uB77C\uC6B0\uC800 TTS" : "\u{1F3AD} \uC0D8\uD50C \uC624\uB514\uC624 \uC7AC\uC0DD"}  
**\u{1F30D} \uC5B8\uC5B4**: ${this.settings.language}  
**\u26A1 \uC18D\uB3C4**: ${this.settings.speed}x  
**\uFFFD \uC74C\uB192\uC774**: ${this.settings.pitch}  
**\u{1F50A} \uBCFC\uB968**: ${this.settings.volume}  
**\u{1F4BE} \uC790\uB3D9 \uC800\uC7A5**: ${this.settings.autoSaveAudio ? "\u2705 \uD65C\uC131\uD654" : "\u274C \uBE44\uD65C\uC131\uD654"}  
**\u{1F4C1} \uCD9C\uB825 \uD3F4\uB354**: \\\`${this.settings.outputFolder}\\\`  
**\u{1F3AD} \uC74C\uC131 \uD504\uB85C\uD544**: ${this.settings.customVoiceData ? "\u2705 \uB4F1\uB85D\uB428" : "\u274C \uBBF8\uB4F1\uB85D"}
\`);
\`\`\`

${this.settings.voiceMode === "custom" ? `
> \u26A0\uFE0F **\uCEE4\uC2A4\uD140 \uC74C\uC131 \uBAA8\uB4DC \uC548\uB0B4**  
> \uD604\uC7AC \uBAA8\uB4DC\uB294 \uB179\uC74C\uD55C \uC0D8\uD50C \uC624\uB514\uC624\uB97C \uC7AC\uC0DD\uD569\uB2C8\uB2E4.  
> \uD14D\uC2A4\uD2B8\uC5D0 \uB530\uB77C \uC74C\uC131\uC774 \uC0DD\uC131\uB418\uC9C0 \uC54A\uC73C\uBA70, \uD56D\uC0C1 \uAC19\uC740 \uC0D8\uD50C\uC774 \uC7AC\uC0DD\uB429\uB2C8\uB2E4.  
> \uD14D\uC2A4\uD2B8\uB97C \uC74C\uC131\uC73C\uB85C \uBCC0\uD658\uD558\uB824\uBA74 "\uBE0C\uB77C\uC6B0\uC800 TTS" \uBAA8\uB4DC\uB97C \uC0AC\uC6A9\uD558\uC138\uC694.
` : ""}

---

## \u{1F4A1} \uC0AC\uC6A9 \uD301

- **TXT \uD30C\uC77C \uC7AC\uC0DD**: \uC704\uC758 "\uC800\uC7A5\uB41C TTS \uD14D\uC2A4\uD2B8 \uD30C\uC77C" \uC139\uC158\uC5D0\uC11C \`\u25B6\uFE0F \uC7AC\uC0DD\` \uB9C1\uD06C\uB97C \uD074\uB9AD\uD558\uBA74 \uC790\uB3D9\uC73C\uB85C \uB0B4\uC6A9\uC744 \uC77D\uC5B4\uC90D\uB2C8\uB2E4
- **\uC790\uB3D9 \uC800\uC7A5**: \uC124\uC815\uC5D0\uC11C "\uC790\uB3D9 \uC800\uC7A5" \uAE30\uB2A5\uC744 \uD65C\uC131\uD654\uD558\uBA74 TTS\uB85C \uC77D\uC740 \uBAA8\uB4E0 \uD14D\uC2A4\uD2B8\uAC00 \uC790\uB3D9\uC73C\uB85C \uC800\uC7A5\uB429\uB2C8\uB2E4
- **\uB2E8\uCD95\uD0A4**: 
  - \uC120\uD0DD\uD55C \uD14D\uC2A4\uD2B8 \uC77D\uAE30: \uD14D\uC2A4\uD2B8 \uC120\uD0DD \uD6C4 \uCEE4\uB9E8\uB4DC \uC2E4\uD589
  - \uC804\uCCB4 \uB178\uD2B8 \uC77D\uAE30: \uCEE4\uB9E8\uB4DC \uD314\uB808\uD2B8\uC5D0\uC11C \uC2E4\uD589
  - \uC815\uC9C0/\uC77C\uC2DC\uC815\uC9C0: \uBC84\uD2BC \uB610\uB294 \uCEE4\uB9E8\uB4DC\uB85C \uC81C\uC5B4

---

*\u{1F4CC} \uC774 \uB300\uC2DC\uBCF4\uB4DC\uB294 \uC790\uB3D9\uC73C\uB85C \uC0DD\uC131\uB418\uC5C8\uC2B5\uB2C8\uB2E4. "\u{1F504} \uB300\uC2DC\uBCF4\uB4DC \uC0C8\uB85C\uACE0\uCE68" \uBC84\uD2BC\uC744 \uB20C\uB7EC \uCD5C\uC2E0 \uC815\uBCF4\uB85C \uC5C5\uB370\uC774\uD2B8\uD558\uC138\uC694.*
`;
  }
  async onunload() {
    this.stopSpeaking();
    if (this.mediaRecorder && this.mediaRecorder.state !== "inactive") {
      this.mediaRecorder.stop();
    }
  }
  async loadSettings() {
    this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.loadData());
  }
  async saveSettings() {
    await this.saveData(this.settings);
  }
};
var TTSReaderModal = class extends import_obsidian.Modal {
  constructor(app, plugin) {
    super(app);
    this.plugin = plugin;
  }
  onOpen() {
    const { contentEl } = this;
    contentEl.empty();
    contentEl.addClass("tts-reader-modal");
    contentEl.createEl("h2", { text: "\u{1F50A} TTS \uC74C\uC131 \uC77D\uAE30" });
    this.textArea = contentEl.createEl("textarea", {
      attr: { placeholder: "\uC77D\uC744 \uD14D\uC2A4\uD2B8\uB97C \uC785\uB825\uD558\uC138\uC694..." }
    });
    this.textArea.style.width = "100%";
    this.textArea.style.minHeight = "200px";
    this.textArea.style.marginBottom = "12px";
    const buttonContainer = contentEl.createDiv({ cls: "tts-button-container" });
    const speakBtn = buttonContainer.createEl("button", {
      text: "\u25B6\uFE0F \uC77D\uAE30",
      cls: "mod-cta"
    });
    speakBtn.onclick = () => {
      const text = this.textArea.value;
      if (text.trim()) {
        this.plugin.speakText(text);
      } else {
        new import_obsidian.Notice("\uD14D\uC2A4\uD2B8\uB97C \uC785\uB825\uD574\uC8FC\uC138\uC694");
      }
    };
    const stopBtn = buttonContainer.createEl("button", { text: "\u23F9\uFE0F \uC815\uC9C0" });
    stopBtn.onclick = () => {
      this.plugin.stopSpeaking();
    };
    const pauseBtn = buttonContainer.createEl("button", { text: "\u23F8\uFE0F \uC77C\uC2DC\uC815\uC9C0/\uC7AC\uAC1C" });
    pauseBtn.onclick = () => {
      this.plugin.togglePause();
    };
  }
  onClose() {
    const { contentEl } = this;
    contentEl.empty();
  }
};

// TXT to MP3 ë³€í™˜ ëª¨ë‹¬
var TxtToMp3Modal = class extends import_obsidian.Modal {
  constructor(app, plugin) {
    super(app);
    this.plugin = plugin;
    this.selectedFile = null;
  }
  
  onOpen() {
    const { contentEl } = this;
    contentEl.empty();
    contentEl.addClass("txt-to-mp3-modal");
    
    contentEl.createEl("h2", { text: "ğŸµ TXT â†’ MP3 ë³€í™˜" });
    
    // íŒŒì¼ ì„ íƒ ì„¹ì…˜
    const fileSection = contentEl.createDiv({ cls: "file-selection-section" });
    fileSection.createEl("h3", { text: "1ï¸âƒ£ TXT íŒŒì¼ ì„ íƒ" });
    
    const fileSelectBtn = fileSection.createEl("button", {
      text: "ğŸ“‚ TXT íŒŒì¼ ì„ íƒ",
      cls: "mod-cta"
    });
    
    this.selectedFileDisplay = fileSection.createDiv({ cls: "selected-file-display" });
    this.selectedFileDisplay.textContent = "ì„ íƒëœ íŒŒì¼ ì—†ìŒ";
    this.selectedFileDisplay.style.marginTop = "10px";
    this.selectedFileDisplay.style.padding = "10px";
    this.selectedFileDisplay.style.background = "var(--background-secondary)";
    this.selectedFileDisplay.style.borderRadius = "5px";
    
    fileSelectBtn.onclick = async () => {
      const txtFiles = this.app.vault.getFiles().filter(f => f.extension === "txt");
      if (txtFiles.length === 0) {
        new import_obsidian.Notice("TXT íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤");
        return;
      }
      
      // íŒŒì¼ ì„ íƒ ëª¨ë‹¬
      const fileNames = txtFiles.map(f => f.path);
      const modal = new FileSelectModal(this.app, fileNames, async (selectedPath) => {
        this.selectedFile = txtFiles.find(f => f.path === selectedPath);
        if (this.selectedFile) {
          this.selectedFileDisplay.textContent = `âœ… ${this.selectedFile.path}`;
          
          // íŒŒì¼ ë‚´ìš© ë¯¸ë¦¬ë³´ê¸°
          const content = await this.app.vault.read(this.selectedFile);
          const preview = content.substring(0, 200);
          this.textPreview.textContent = preview + (content.length > 200 ? "..." : "");
        }
      });
      modal.open();
    };
    
    // í…ìŠ¤íŠ¸ ë¯¸ë¦¬ë³´ê¸°
    const previewSection = contentEl.createDiv({ cls: "preview-section" });
    previewSection.createEl("h3", { text: "2ï¸âƒ£ í…ìŠ¤íŠ¸ ë¯¸ë¦¬ë³´ê¸°" });
    this.textPreview = previewSection.createEl("div", { cls: "text-preview" });
    this.textPreview.textContent = "íŒŒì¼ì„ ì„ íƒí•˜ë©´ ë¯¸ë¦¬ë³´ê¸°ê°€ í‘œì‹œë©ë‹ˆë‹¤";
    this.textPreview.style.padding = "15px";
    this.textPreview.style.background = "var(--background-secondary)";
    this.textPreview.style.borderRadius = "5px";
    this.textPreview.style.maxHeight = "150px";
    this.textPreview.style.overflowY = "auto";
    this.textPreview.style.whiteSpace = "pre-wrap";
    this.textPreview.style.marginTop = "10px";
    
    // ìŒì„± ì˜µì…˜
    const optionsSection = contentEl.createDiv({ cls: "options-section" });
    optionsSection.createEl("h3", { text: "3ï¸âƒ£ ìŒì„± ì˜µì…˜" });
    
    const voiceSelect = optionsSection.createEl("select", { cls: "voice-select" });
    voiceSelect.style.width = "100%";
    voiceSelect.style.marginBottom = "10px";
    voiceSelect.style.padding = "8px";
    
    // ë¸Œë¼ìš°ì € ìŒì„± ë¡œë“œ
    if (this.plugin.synthesis) {
      const voices = this.plugin.synthesis.getVoices();
      voices.forEach(voice => {
        const option = voiceSelect.createEl("option");
        option.value = voice.name;
        option.textContent = `${voice.name} (${voice.lang})`;
      });
    }
    
    // ì†ë„ ì¡°ì ˆ
    const speedLabel = optionsSection.createEl("label", { text: "ì†ë„: " });
    const speedInput = optionsSection.createEl("input", {
      type: "range",
      attr: { min: "0.5", max: "2", step: "0.1", value: "1" }
    });
    speedInput.style.width = "100%";
    const speedValue = optionsSection.createEl("span", { text: "1.0x" });
    speedInput.oninput = () => {
      speedValue.textContent = `${speedInput.value}x`;
    };
    
    // ë³€í™˜ ë²„íŠ¼
    const convertSection = contentEl.createDiv({ cls: "convert-section" });
    convertSection.createEl("h3", { text: "4ï¸âƒ£ ìŒì„± ì¬ìƒ" });
    
    const convertBtn = convertSection.createEl("button", {
      text: "ğŸ”Š ìŒì„±ìœ¼ë¡œ ì¬ìƒ",
      cls: "mod-cta convert-button"
    });
    convertBtn.style.width = "100%";
    convertBtn.style.padding = "12px";
    convertBtn.style.fontSize = "16px";
    
    this.progressDisplay = convertSection.createDiv({ cls: "progress-display" });
    this.progressDisplay.style.marginTop = "15px";
    this.progressDisplay.style.display = "none";
    
    // ì•ˆë‚´ ë©”ì‹œì§€
    const infoSection = contentEl.createDiv({ cls: "info-section" });
    infoSection.style.marginTop = "15px";
    infoSection.style.padding = "10px";
    infoSection.style.background = "var(--background-secondary)";
    infoSection.style.borderRadius = "5px";
    infoSection.innerHTML = `
      <h4>ğŸ’¡ MP3 íŒŒì¼ë¡œ ì €ì¥í•˜ë ¤ë©´:</h4>
      <p>Windowsì—ì„œ ì‹œìŠ¤í…œ ì˜¤ë””ì˜¤ë¥¼ ë…¹ìŒí•  ìˆ˜ ìˆëŠ” í”„ë¡œê·¸ë¨ì„ ì‚¬ìš©í•˜ì„¸ìš”:</p>
      <ul>
        <li>Audacity (ë¬´ë£Œ)</li>
        <li>OBS Studio (ë¬´ë£Œ)</li>
        <li>Windows ìŒì„± ë…¹ìŒê¸° (ë‚´ì¥)</li>
      </ul>
    `;
    
    convertBtn.onclick = async () => {
      if (!this.selectedFile) {
        new import_obsidian.Notice("íŒŒì¼ì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”");
        return;
      }
      
      const voiceName = voiceSelect.value;
      const speed = parseFloat(speedInput.value);
      
      await this.convertToMp3(voiceName, speed);
    };
  }
  
  async convertToMp3(voiceName, speed) {
    try {
      this.progressDisplay.style.display = "block";
      this.progressDisplay.textContent = "ğŸ”„ íŒŒì¼ ì½ëŠ” ì¤‘...";
      
      const content = await this.app.vault.read(this.selectedFile);
      
      this.progressDisplay.textContent = "ğŸ¤ ìŒì„± ì¬ìƒ ì¤‘...";
      
      // ë¸Œë¼ìš°ì € TTSë¡œ ìŒì„± ì¬ìƒ
      const utterance = new SpeechSynthesisUtterance(content);
      const voices = this.plugin.synthesis.getVoices();
      const selectedVoice = voices.find(v => v.name === voiceName);
      if (selectedVoice) {
        utterance.voice = selectedVoice;
      }
      utterance.rate = speed;
      utterance.pitch = this.plugin.settings.pitch;
      utterance.volume = this.plugin.settings.volume;
      
      // ìŒì„± ì¬ìƒ
      utterance.onstart = () => {
        this.progressDisplay.textContent = "ğŸ”Š ìŒì„± ì¬ìƒ ì¤‘... (ë…¹ìŒí•˜ë ¤ë©´ ì‹œìŠ¤í…œ ì˜¤ë””ì˜¤ ìº¡ì²˜ í•„ìš”)";
        new import_obsidian.Notice("ğŸ”Š ìŒì„± ì¬ìƒ ì‹œì‘");
      };
      
      utterance.onend = () => {
        this.progressDisplay.textContent = "âœ… ì¬ìƒ ì™„ë£Œ! ï¿½ MP3 ì €ì¥í•˜ë ¤ë©´ ì‹œìŠ¤í…œ ì˜¤ë””ì˜¤ ë…¹ìŒ ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.";
        new import_obsidian.Notice("âœ… ì¬ìƒ ì™„ë£Œ");
      };
      
      utterance.onerror = (error) => {
        this.progressDisplay.textContent = `âŒ ì¬ìƒ ì‹¤íŒ¨: ${error.error}`;
        new import_obsidian.Notice("ì¬ìƒ ì‹¤íŒ¨: " + error.error);
      };
      
      this.plugin.synthesis.speak(utterance);
      
    } catch (error) {
      console.error("ë³€í™˜ ì‹¤íŒ¨:", error);
      this.progressDisplay.textContent = `âŒ ë³€í™˜ ì‹¤íŒ¨: ${error.message}`;
      new import_obsidian.Notice("ë³€í™˜ ì‹¤íŒ¨: " + error.message);
    }
  }
  
  onClose() {
    const { contentEl } = this;
    contentEl.empty();
  }
};

// íŒŒì¼ ì„ íƒ ëª¨ë‹¬
var FileSelectModal = class extends import_obsidian.Modal {
  constructor(app, fileNames, onSelect) {
    super(app);
    this.fileNames = fileNames;
    this.onSelect = onSelect;
  }
  
  onOpen() {
    const { contentEl } = this;
    contentEl.empty();
    contentEl.createEl("h2", { text: "íŒŒì¼ ì„ íƒ" });
    
    const fileList = contentEl.createDiv({ cls: "file-list" });
    fileList.style.maxHeight = "400px";
    fileList.style.overflowY = "auto";
    
    this.fileNames.forEach(fileName => {
      const fileItem = fileList.createDiv({ cls: "file-item" });
      fileItem.textContent = fileName;
      fileItem.style.padding = "10px";
      fileItem.style.cursor = "pointer";
      fileItem.style.borderBottom = "1px solid var(--background-modifier-border)";
      
      fileItem.onmouseenter = () => {
        fileItem.style.background = "var(--background-modifier-hover)";
      };
      
      fileItem.onmouseleave = () => {
        fileItem.style.background = "";
      };
      
      fileItem.onclick = () => {
        this.onSelect(fileName);
        this.close();
      };
    });
  }
  
  onClose() {
    const { contentEl } = this;
    contentEl.empty();
  }
};

var VoiceRecordModal = class extends import_obsidian.Modal {
  constructor(app, plugin) {
    super(app);
    this.isRecording = false;
    this.recordingTime = 0;
    this.timerInterval = null;
    this.plugin = plugin;
  }
  onOpen() {
    const { contentEl } = this;
    contentEl.empty();
    contentEl.addClass("voice-record-modal");
    contentEl.createEl("h2", { text: "\u{1F399}\uFE0F \uB0B4 \uC74C\uC131 \uB179\uC74C\uD558\uAE30" });
    contentEl.createEl("p", {
      text: "10\uCD08~60\uCD08 \uB3D9\uC548 \uC790\uC5F0\uC2A4\uB7FD\uAC8C \uB9D0\uD574\uC8FC\uC138\uC694. \uB179\uC74C\uB41C \uC74C\uC131\uC740 \uC74C\uC131 \uD504\uB85C\uD544\uB85C \uC800\uC7A5\uB429\uB2C8\uB2E4.",
      cls: "voice-record-desc"
    });
    this.statusText = contentEl.createDiv({ cls: "recording-status" });
    this.statusText.textContent = "\uC900\uBE44\uB428";
    const timerDisplay = contentEl.createDiv({ cls: "recording-timer" });
    timerDisplay.textContent = "00:00";
    this.recordButton = contentEl.createEl("button", {
      text: "\u{1F534} \uB179\uC74C \uC2DC\uC791",
      cls: "mod-cta record-button"
    });
    this.recordButton.onclick = async () => {
      if (!this.isRecording) {
        await this.startRecording(timerDisplay);
      } else {
        await this.stopRecording();
      }
    };
    const guide = contentEl.createDiv({ cls: "recording-guide" });
    guide.innerHTML = `
            <h4>\u{1F4CB} \uB179\uC74C \uAC00\uC774\uB4DC:</h4>
            <ul>
                <li>\uC870\uC6A9\uD55C \uD658\uACBD\uC5D0\uC11C \uB179\uC74C\uD558\uC138\uC694</li>
                <li>\uB9C8\uC774\uD06C\uC640 \uC801\uB2F9\uD55C \uAC70\uB9AC\uB97C \uC720\uC9C0\uD558\uC138\uC694</li>
                <li>\uC790\uC5F0\uC2A4\uB7FD\uACE0 \uB610\uBC15\uB610\uBC15 \uB9D0\uD574\uC8FC\uC138\uC694</li>
                <li>\uCD5C\uC18C 10\uCD08 \uC774\uC0C1 \uB179\uC74C\uD574\uC8FC\uC138\uC694</li>
                <li>\uC608\uC2DC: "\uC548\uB155\uD558\uC138\uC694. \uC800\uB294 [\uC774\uB984]\uC785\uB2C8\uB2E4. \uC624\uB298\uC740 \uB0A0\uC528\uAC00 \uC88B\uB124\uC694. \uC635\uC2DC\uB514\uC5B8\uC73C\uB85C \uACF5\uBD80 \uC911\uC785\uB2C8\uB2E4."</li>
            </ul>
        `;
  }
  async startRecording(timerDisplay) {
    try {
      this.isRecording = true;
      this.recordButton.textContent = "\u23F9\uFE0F \uB179\uC74C \uC911\uC9C0";
      this.recordButton.removeClass("mod-cta");
      this.recordButton.addClass("mod-warning");
      this.statusText.textContent = "\u{1F399}\uFE0F \uB179\uC74C \uC911...";
      this.statusText.style.color = "var(--text-error)";
      this.recordingTime = 0;
      this.timerInterval = window.setInterval(() => {
        this.recordingTime++;
        const minutes = Math.floor(this.recordingTime / 60);
        const seconds = this.recordingTime % 60;
        timerDisplay.textContent = `${String(minutes).padStart(2, "0")}:${String(seconds).padStart(2, "0")}`;
      }, 1e3);
      await this.plugin.startRecording();
    } catch (error) {
      this.isRecording = false;
      this.recordButton.textContent = "\u{1F534} \uB179\uC74C \uC2DC\uC791";
      this.recordButton.removeClass("mod-warning");
      this.recordButton.addClass("mod-cta");
      this.statusText.textContent = "\u274C \uB179\uC74C \uC2DC\uC791 \uC2E4\uD328";
      this.statusText.style.color = "var(--text-error)";
      if (this.timerInterval) {
        clearInterval(this.timerInterval);
        this.timerInterval = null;
      }
    }
  }
  async stopRecording() {
    this.isRecording = false;
    this.recordButton.textContent = "\u23F3 \uCC98\uB9AC \uC911...";
    this.recordButton.removeClass("mod-warning");
    this.recordButton.disabled = true;
    this.statusText.textContent = "\uCC98\uB9AC \uC911...";
    this.statusText.style.color = "var(--text-muted)";
    if (this.timerInterval) {
      clearInterval(this.timerInterval);
      this.timerInterval = null;
    }
    try {
      const audioBlob = await this.plugin.stopRecording();
      if (audioBlob && audioBlob.size > 0) {
        this.statusText.textContent = "\u{1F4BE} \uC800\uC7A5 \uC911...";
        const reader = new FileReader();
        reader.onloadend = async () => {
          try {
            const base64 = reader.result;
            this.plugin.settings.customVoiceData = base64;
            await this.plugin.saveSettings();
            const extension = audioBlob.type.includes("webm") ? "webm" : audioBlob.type.includes("ogg") ? "ogg" : audioBlob.type.includes("mp4") ? "mp4" : "webm";
            await this.plugin.saveAudioFile(audioBlob, `my_voice_profile.${extension}`);
            this.statusText.textContent = "\u2705 \uB179\uC74C \uC644\uB8CC! \uC74C\uC131 \uD504\uB85C\uD544\uC774 \uC800\uC7A5\uB418\uC5C8\uC2B5\uB2C8\uB2E4.";
            this.statusText.style.color = "var(--text-success)";
            new import_obsidian.Notice("\u2705 \uC74C\uC131 \uD504\uB85C\uD544 \uC800\uC7A5 \uC644\uB8CC! (" + Math.round(audioBlob.size / 1024) + "KB)");
            setTimeout(() => this.close(), 2e3);
          } catch (error) {
            this.statusText.textContent = "\u274C \uC800\uC7A5 \uC2E4\uD328: " + error.message;
            this.statusText.style.color = "var(--text-error)";
            this.recordButton.disabled = false;
            this.recordButton.textContent = "\u{1F534} \uB179\uC74C \uC2DC\uC791";
            this.recordButton.addClass("mod-cta");
            console.error("Save voice profile error:", error);
          }
        };
        reader.onerror = () => {
          this.statusText.textContent = "\u274C \uD30C\uC77C \uC77D\uAE30 \uC2E4\uD328";
          this.statusText.style.color = "var(--text-error)";
          this.recordButton.disabled = false;
          this.recordButton.textContent = "\u{1F534} \uB179\uC74C \uC2DC\uC791";
          this.recordButton.addClass("mod-cta");
        };
        reader.readAsDataURL(audioBlob);
      } else {
        this.statusText.textContent = "\u274C \uB179\uC74C \uB370\uC774\uD130\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4. \uB2E4\uC2DC \uC2DC\uB3C4\uD558\uC138\uC694.";
        this.statusText.style.color = "var(--text-error)";
        this.recordButton.disabled = false;
        this.recordButton.textContent = "\u{1F534} \uB179\uC74C \uC2DC\uC791";
        this.recordButton.addClass("mod-cta");
      }
    } catch (error) {
      this.statusText.textContent = "\u274C \uB179\uC74C \uC911\uC9C0 \uC2E4\uD328: " + error.message;
      this.statusText.style.color = "var(--text-error)";
      this.recordButton.disabled = false;
      this.recordButton.textContent = "\u{1F534} \uB179\uC74C \uC2DC\uC791";
      this.recordButton.addClass("mod-cta");
      console.error("Stop recording error:", error);
    }
  }
  onClose() {
    if (this.timerInterval) {
      clearInterval(this.timerInterval);
    }
    const { contentEl } = this;
    contentEl.empty();
  }
};
var TTSSettingTab = class extends import_obsidian.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  async display() {
    const { containerEl } = this;
    containerEl.empty();
    containerEl.createEl("h2", { text: "TTS \uC74C\uC131 \uC124\uC815" });
    if (this.plugin.availableVoices.length === 0) {
      console.log("\u26A0\uFE0F \uC124\uC815 \uD0ED: \uC74C\uC131 \uBAA9\uB85D\uC774 \uBE44\uC5B4\uC788\uC74C. \uC7AC\uB85C\uB4DC \uC2DC\uB3C4...");
      await this.plugin.loadVoices();
    }
    new import_obsidian.Setting(containerEl).setName("\uC74C\uC131 \uBAA8\uB4DC").setDesc("Edge TTS: Microsoft ê³ í’ˆì§ˆ ìŒì„± (ì¶”ì²œ) | \uBE0C\uB77C\uC6B0\uC800 TTS: \uD14D\uC2A4\uD2B8\uB97C \uC74C\uC131\uC73C\uB85C \uBCC0\uD658 | \uCEE4\uC2A4\uD140: \uB179\uC74C\uD55C \uC0D8\uD50C \uC624\uB514\uC624 \uC7AC\uC0DD").addDropdown((dropdown) => dropdown.addOption("edge", "\u{1F310} Edge TTS (\uCD94\uCC9C)").addOption("browser", "\u{1F50A} \uBE0C\uB77C\uC6B0\uC800 TTS").addOption("custom", "\u{1F3AD} \uB0B4 \uBAA9\uC18C\uB9AC \uC0D8\uD50C").setValue(this.plugin.settings.voiceMode).onChange(async (value) => {
      this.plugin.settings.voiceMode = value;
      await this.plugin.saveSettings();
      if (value === "custom" && !this.plugin.settings.customVoiceData) {
        new import_obsidian.Notice("\u26A0\uFE0F \uBA3C\uC800 \uC74C\uC131\uC744 \uB179\uC74C\uD574\uC8FC\uC138\uC694");
      } else if (value === "custom") {
        new import_obsidian.Notice("\u26A0\uFE0F \uCEE4\uC2A4\uD140 \uBAA8\uB4DC\uB294 \uB179\uC74C\uD55C \uC0D8\uD50C\uB9CC \uC7AC\uC0DD\uD569\uB2C8\uB2E4 (TTS \uC544\uB2D8)");
      } else if (value === "edge") {
        new import_obsidian.Notice("\u2705 Edge TTS \uBAA8\uB4DC\uB85C \uBCC0\uACBD\uB418\uC5C8\uC2B5\uB2C8\uB2E4");
      }
      this.display();
    }));
    
    // Edge TTS ìŒì„± ì„ íƒ (Edge ëª¨ë“œì¼ ë•Œë§Œ í‘œì‹œ)
    if (this.plugin.settings.voiceMode === "edge") {
      const edgeVoiceSetting = new import_obsidian.Setting(containerEl)
        .setName("ğŸŒ Edge TTS ìŒì„±")
        .setDesc(`ì‚¬ìš© ê°€ëŠ¥í•œ Edge TTS ìŒì„±: ${this.plugin.edgeVoices.length}ê°œ`);
      
      edgeVoiceSetting.addDropdown((dropdown) => {
        if (this.plugin.edgeVoices.length === 0) {
          dropdown.addOption("ko-KR-SunHiNeural", "ko-KR-SunHiNeural (ê¸°ë³¸)");
        } else {
          this.plugin.edgeVoices.forEach((voice) => {
            const label = `${voice.displayName || voice.name} (${voice.lang})`;
            dropdown.addOption(voice.name, label);
          });
        }
        dropdown.setValue(this.plugin.settings.edgeVoice || "ko-KR-SunHiNeural");
        dropdown.onChange(async (value) => {
          this.plugin.settings.edgeVoice = value;
          await this.plugin.saveSettings();
          console.log(`ğŸ¤ Edge ìŒì„± ë³€ê²½ë¨: ${value}`);
          new import_obsidian.Notice(`âœ… ${value} ì„ íƒë¨`);
        });
        return dropdown;
      });
    }
    
    // ë¸Œë¼ìš°ì € TTS ìŒì„± ì„ íƒ (Browser ëª¨ë“œì¼ ë•Œë§Œ í‘œì‹œ)
    if (this.plugin.settings.voiceMode === "browser") {
    const voiceSetting = new import_obsidian.Setting(containerEl).setName("\uBE0C\uB77C\uC6B0\uC800 \uC74C\uC131").setDesc("\uC0AC\uC6A9\uD560 \uC74C\uC131\uC744 \uC120\uD0DD\uD558\uC138\uC694");
    voiceSetting.addButton((button) => button.setButtonText("\u{1F504} \uC0C8\uB85C\uACE0\uCE68").setTooltip("\uC74C\uC131 \uBAA9\uB85D \uB2E4\uC2DC \uBD88\uB7EC\uC624\uAE30").onClick(async () => {
      new import_obsidian.Notice("\u{1F504} \uC74C\uC131 \uBAA9\uB85D \uC0C8\uB85C\uACE0\uCE68 \uC911...");
      await this.plugin.loadVoices();
      await new Promise((resolve) => setTimeout(resolve, 500));
      this.display();
      new import_obsidian.Notice(`\u2705 ${this.plugin.availableVoices.length}\uAC1C \uC74C\uC131 \uB85C\uB4DC\uB428`);
    }));
    if (this.plugin.availableVoices.length === 0) {
      voiceSetting.setDesc("\u26A0\uFE0F \uC0AC\uC6A9 \uAC00\uB2A5\uD55C \uC74C\uC131\uC774 \uC5C6\uC2B5\uB2C8\uB2E4. \uC0C8\uB85C\uACE0\uCE68 \uBC84\uD2BC\uC744 \uB20C\uB7EC\uC8FC\uC138\uC694.");
      console.warn("\u274C \uC74C\uC131 \uBAA9\uB85D\uC774 \uBE44\uC5B4\uC788\uC2B5\uB2C8\uB2E4:", this.plugin.availableVoices);
    } else {
      voiceSetting.setDesc(`\u2705 ${this.plugin.availableVoices.length}\uAC1C \uC74C\uC131 \uC0AC\uC6A9 \uAC00\uB2A5`);
      console.log(`\u2705 \uC124\uC815 \uD0ED: ${this.plugin.availableVoices.length}\uAC1C \uC74C\uC131 \uD45C\uC2DC`);
    }
    voiceSetting.addDropdown((dropdown) => {
      if (this.plugin.availableVoices.length === 0) {
        dropdown.addOption("", "(\uC74C\uC131 \uC5C6\uC74C - \uC0C8\uB85C\uACE0\uCE68 \uD544\uC694)");
      } else {
        this.plugin.availableVoices.forEach((voice) => {
          dropdown.addOption(voice.name, `${voice.name} (${voice.lang})`);
        });
      }
      dropdown.setValue(this.plugin.settings.browserVoice);
      dropdown.onChange(async (value) => {
        this.plugin.settings.browserVoice = value;
        await this.plugin.saveSettings();
        console.log(`\u{1F3A4} \uC74C\uC131 \uBCC0\uACBD\uB428: ${value}`);
      });
      return dropdown;
    });
    }  // Browser ëª¨ë“œ if ë¬¸ ë‹«ê¸°
    
    new import_obsidian.Setting(containerEl).setName("\uC5B8\uC5B4").setDesc("\uC74C\uC131 \uC77D\uAE30 \uC5B8\uC5B4").addDropdown((dropdown) => dropdown.addOption("ko-KR", "\uD55C\uAD6D\uC5B4").addOption("en-US", "\uC601\uC5B4").addOption("ja-JP", "\uC77C\uBCF8\uC5B4").addOption("zh-CN", "\uC911\uAD6D\uC5B4").setValue(this.plugin.settings.language).onChange(async (value) => {
      this.plugin.settings.language = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(containerEl).setName("\uC77D\uAE30 \uC18D\uB3C4").setDesc("\uC74C\uC131 \uC77D\uAE30 \uC18D\uB3C4 (0.5 = \uB290\uB9BC, 1.0 = \uBCF4\uD1B5, 2.0 = \uBE60\uB984)").addSlider((slider) => slider.setLimits(0.5, 2, 0.1).setValue(this.plugin.settings.speed).setDynamicTooltip().onChange(async (value) => {
      this.plugin.settings.speed = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(containerEl).setName("\uC74C\uB192\uC774").setDesc("\uC74C\uC131\uC758 \uB192\uB0AE\uC774 (0.5 = \uB0AE\uC74C, 1.0 = \uBCF4\uD1B5, 2.0 = \uB192\uC74C)").addSlider((slider) => slider.setLimits(0.5, 2, 0.1).setValue(this.plugin.settings.pitch).setDynamicTooltip().onChange(async (value) => {
      this.plugin.settings.pitch = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(containerEl).setName("\uC74C\uB7C9").setDesc("\uC74C\uC131\uC758 \uD06C\uAE30 (0.0 = \uBB34\uC74C, 1.0 = \uCD5C\uB300)").addSlider((slider) => slider.setLimits(0, 1, 0.1).setValue(this.plugin.settings.volume).setDynamicTooltip().onChange(async (value) => {
      this.plugin.settings.volume = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(containerEl).setName("\u{1F4DD} \uC790\uB3D9 \uC800\uC7A5").setDesc("TTS \uC77D\uAE30\uAC00 \uC644\uB8CC\uB418\uBA74 \uD14D\uC2A4\uD2B8\uB97C \uC790\uB3D9\uC73C\uB85C \uD30C\uC77C\uB85C \uC800\uC7A5").addToggle((toggle) => toggle.setValue(this.plugin.settings.autoSaveAudio).onChange(async (value) => {
      this.plugin.settings.autoSaveAudio = value;
      await this.plugin.saveSettings();
      new import_obsidian.Notice(value ? "\u2705 \uC790\uB3D9 \uC800\uC7A5 \uD65C\uC131\uD654" : "\u274C \uC790\uB3D9 \uC800\uC7A5 \uBE44\uD65C\uC131\uD654");
    }));
    new import_obsidian.Setting(containerEl).setName("\uC74C\uC131 \uD30C\uC77C \uC800\uC7A5 \uD3F4\uB354").setDesc("\uB179\uC74C\uB41C \uC74C\uC131 \uD30C\uC77C\uC744 \uC800\uC7A5\uD560 \uD3F4\uB354").addText((text) => text.setPlaceholder("TTS Audio").setValue(this.plugin.settings.outputFolder).onChange(async (value) => {
      this.plugin.settings.outputFolder = value;
      await this.plugin.saveSettings();
    }));
    const modeStatus = containerEl.createDiv({
      cls: "current-mode-status"
    });
    modeStatus.style.padding = "12px";
    modeStatus.style.backgroundColor = "var(--background-secondary)";
    modeStatus.style.borderRadius = "8px";
    modeStatus.style.marginTop = "15px";
    modeStatus.style.marginBottom = "15px";
    modeStatus.style.borderLeft = "4px solid var(--interactive-accent)";
    const modeText = this.plugin.settings.voiceMode === "browser" ? "\u{1F310} \uD604\uC7AC \uBAA8\uB4DC: \uBE0C\uB77C\uC6B0\uC800 TTS" : "\u{1F3AD} \uD604\uC7AC \uBAA8\uB4DC: \uC0D8\uD50C \uC624\uB514\uC624 \uC7AC\uC0DD";
    const modeDesc = this.plugin.settings.voiceMode === "browser" ? "\uBE0C\uB77C\uC6B0\uC800 \uAE30\uBCF8 \uC74C\uC131\uC73C\uB85C \uD14D\uC2A4\uD2B8\uB97C \uC77D\uC5B4\uC90D\uB2C8\uB2E4" : this.plugin.settings.customVoiceData ? "\u26A0\uFE0F \uB179\uC74C\uD55C \uC0D8\uD50C \uC624\uB514\uC624\uB9CC \uC7AC\uC0DD\uB429\uB2C8\uB2E4 (TTS \uC544\uB2D8)" : "\u26A0\uFE0F \uC74C\uC131 \uD504\uB85C\uD544\uC774 \uC5C6\uC2B5\uB2C8\uB2E4. \uBA3C\uC800 \uB179\uC74C\uD574\uC8FC\uC138\uC694!";
    modeStatus.innerHTML = `
            <div style="font-weight: bold; font-size: 1.1em; margin-bottom: 4px;">${modeText}</div>
            <div style="color: var(--text-muted); font-size: 0.9em;">${modeDesc}</div>
            <div style="color: var(--text-muted); font-size: 0.85em; margin-top: 4px;">
                ${this.plugin.settings.autoSaveAudio ? "\u{1F4BE} \uC790\uB3D9 \uC800\uC7A5: \uCF1C\uC9D0" : ""}
            </div>
        `;
    new import_obsidian.Setting(containerEl).setName("\uC74C\uC131 \uD14C\uC2A4\uD2B8").setDesc("\uD604\uC7AC \uC124\uC815\uC73C\uB85C \uD14C\uC2A4\uD2B8 \uC74C\uC131\uC744 \uB4E4\uC5B4\uBCF4\uC138\uC694").addButton((button) => button.setButtonText("\u{1F50A} \uD14C\uC2A4\uD2B8").onClick(() => {
      const testMode = this.plugin.settings.voiceMode === "browser" ? "\uBE0C\uB77C\uC6B0\uC800 \uBAA8\uB4DC" : "\uCEE4\uC2A4\uD140 \uBAA8\uB4DC";
      new import_obsidian.Notice(`\u{1F3B5} ${testMode}\uB85C \uC7AC\uC0DD \uC911...`);
      this.plugin.speakText("\uC548\uB155\uD558\uC138\uC694. \uC774\uAC83\uC740 \uC74C\uC131 \uD14C\uC2A4\uD2B8\uC785\uB2C8\uB2E4. \uC635\uC2DC\uB514\uC5B8 TTS \uD50C\uB7EC\uADF8\uC778\uC774 \uC815\uC0C1\uC801\uC73C\uB85C \uC791\uB3D9\uD558\uACE0 \uC788\uC2B5\uB2C8\uB2E4.");
    }));
    containerEl.createEl("h2", { text: "\u{1F4C1} \uD3F4\uB354 \uC124\uC815" });
    new import_obsidian.Setting(containerEl).setName("\uD14D\uC2A4\uD2B8 \uCD9C\uB825 \uD3F4\uB354").setDesc("TXT \uD30C\uC77C\uC774 \uC800\uC7A5\uB420 \uD3F4\uB354").addText((text) => text.setPlaceholder("TTS Audio/Text").setValue(this.plugin.settings.outputFolder).onChange(async (value) => {
      this.plugin.settings.outputFolder = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(containerEl).setName("\uC624\uB514\uC624 \uCD9C\uB825 \uD3F4\uB354").setDesc("\uB179\uC74C\uB41C \uC74C\uC131 \uD30C\uC77C\uC774 \uC800\uC7A5\uB420 \uD3F4\uB354").addText((text) => text.setPlaceholder("TTS Audio/Voice").setValue(this.plugin.settings.audioFolder).onChange(async (value) => {
      this.plugin.settings.audioFolder = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(containerEl).setName("\uB300\uC2DC\uBCF4\uB4DC \uD3F4\uB354").setDesc("TTS \uB300\uC2DC\uBCF4\uB4DC\uAC00 \uC0DD\uC131\uB420 \uD3F4\uB354").addText((text) => text.setPlaceholder("TTS Dashboard").setValue(this.plugin.settings.dashboardFolder).onChange(async (value) => {
      this.plugin.settings.dashboardFolder = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(containerEl).setName("\uB300\uC2DC\uBCF4\uB4DC \uC0DD\uC131").setDesc("TTS \uD30C\uC77C \uAD00\uB9AC \uBC0F \uD1B5\uACC4\uB97C \uC704\uD55C \uB300\uC2DC\uBCF4\uB4DC \uC0DD\uC131").addButton((button) => button.setButtonText("\u{1F4CA} \uB300\uC2DC\uBCF4\uB4DC \uC0DD\uC131").setCta().onClick(async () => {
      await this.plugin.createDashboard();
    }));
    containerEl.createEl("h2", { text: "\u{1F399}\uFE0F \uC74C\uC131 \uB179\uC74C" });
    new import_obsidian.Setting(containerEl).setName("\uC74C\uC131 \uB179\uC74C").setDesc("\uB0B4 \uBAA9\uC18C\uB9AC\uB97C \uB179\uC74C\uD558\uC5EC \uC74C\uC131 \uD504\uB85C\uD544 \uC0DD\uC131").addButton((button) => button.setButtonText("\u{1F399}\uFE0F \uB179\uC74C\uD558\uAE30").onClick(() => {
      new VoiceRecordModal(this.app, this.plugin).open();
    }));
    if (this.plugin.settings.customVoiceData) {
      const statusDiv = containerEl.createDiv({
        text: "\u2705 \uC74C\uC131 \uD504\uB85C\uD544\uC774 \uC800\uC7A5\uB418\uC5C8\uC2B5\uB2C8\uB2E4",
        cls: "voice-profile-status"
      });
      statusDiv.style.color = "var(--text-success)";
      statusDiv.style.padding = "10px";
      statusDiv.style.backgroundColor = "var(--background-secondary)";
      statusDiv.style.borderRadius = "8px";
      statusDiv.style.marginTop = "10px";
      new import_obsidian.Setting(containerEl).setName("\uC74C\uC131 \uD504\uB85C\uD544 \uD14C\uC2A4\uD2B8").setDesc("\uB179\uC74C\uD55C \uB0B4 \uBAA9\uC18C\uB9AC \uC0D8\uD50C\uC744 \uC7AC\uC0DD\uD574\uBD05\uB2C8\uB2E4").addButton((button) => button.setButtonText("\u{1F50A} \uC0D8\uD50C \uC7AC\uC0DD").onClick(async () => {
        await this.plugin.speakWithCustomVoice("\uC548\uB155\uD558\uC138\uC694. \uC774\uAC83\uC740 \uB179\uC74C\uB41C \uC74C\uC131 \uD504\uB85C\uD544 \uD14C\uC2A4\uD2B8\uC785\uB2C8\uB2E4.");
      }));
      new import_obsidian.Setting(containerEl).setName("\uC74C\uC131 \uD504\uB85C\uD544 \uC0AD\uC81C").setDesc("\uC800\uC7A5\uB41C \uC74C\uC131 \uD504\uB85C\uD544\uC744 \uC0AD\uC81C\uD569\uB2C8\uB2E4").addButton((button) => button.setButtonText("\u{1F5D1}\uFE0F \uC0AD\uC81C").setWarning().onClick(async () => {
        if (confirm("\uC74C\uC131 \uD504\uB85C\uD544\uC744 \uC0AD\uC81C\uD558\uC2DC\uACA0\uC2B5\uB2C8\uAE4C?")) {
          this.plugin.settings.customVoiceData = null;
          await this.plugin.saveSettings();
          new import_obsidian.Notice("\u2705 \uC74C\uC131 \uD504\uB85C\uD544\uC774 \uC0AD\uC81C\uB418\uC5C8\uC2B5\uB2C8\uB2E4");
          this.display();
        }
      }));
    }
  }
};
var TTSDashboardModal = class extends import_obsidian.Modal {
  constructor(app, plugin) {
    super(app);
    this.plugin = plugin;
  }
  async onOpen() {
    const { contentEl } = this;
    contentEl.empty();
    contentEl.addClass("tts-dashboard-modal");
    const header = contentEl.createDiv({ cls: "dashboard-header" });
    const headerTitle = header.createDiv({ cls: "header-title" });
    headerTitle.createEl("h1", { text: "\u{1F399}\uFE0F TTS \uD1B5\uD569 \uB300\uC2DC\uBCF4\uB4DC" });
    const headerActions = header.createDiv({ cls: "header-actions" });
    const settingsBtn = headerActions.createEl("button", {
      text: "\u2699\uFE0F \uC124\uC815",
      cls: "settings-btn"
    });
    settingsBtn.onclick = () => {
      this.close();
      this.app.setting.open();
      this.app.setting.openTabById(this.plugin.manifest.id);
    };
    const statsSection = contentEl.createDiv({ cls: "stats-section" });
    const stats = await this.getStats();
    const statsGrid = statsSection.createDiv({ cls: "stats-grid" });
    this.createStatCard(statsGrid, "\u{1F4C4}", "TXT \uD30C\uC77C", `${stats.txtFiles}\uAC1C`, "#4caf50");
    this.createStatCard(statsGrid, "\u{1F3B5}", "\uC624\uB514\uC624 \uD30C\uC77C", `${stats.audioFiles}\uAC1C`, "#2196f3");
    this.createStatCard(statsGrid, "\u{1F3AD}", "\uC74C\uC131 \uD504\uB85C\uD544", stats.hasProfile ? "\uB4F1\uB85D\uB428" : "\uBBF8\uB4F1\uB85D", "#ff9800");
    this.createStatCard(statsGrid, "\u{1F4BE}", "\uC790\uB3D9 \uC800\uC7A5", this.plugin.settings.autoSaveAudio ? "\uD65C\uC131\uD654" : "\uBE44\uD65C\uC131\uD654", "#9c27b0");
    const actionsSection = contentEl.createDiv({ cls: "actions-section" });
    actionsSection.createEl("h2", { text: "\u{1F680} \uBE60\uB978 \uC791\uC5C5" });
    const actionsGrid = actionsSection.createDiv({ cls: "actions-grid" });
    const actions = [
      { icon: "\u{1F4DD}", text: "\uC0C8 \uD14D\uC2A4\uD2B8 \uC77D\uAE30", color: "blue", callback: () => {
        this.close();
        new TTSReaderModal(this.app, this.plugin).open();
      } },
      { icon: "\u{1F399}\uFE0F", text: "\uC74C\uC131 \uB179\uC74C", color: "green", callback: () => {
        this.close();
        new VoiceRecordModal(this.app, this.plugin).open();
      } },
      { icon: "\u23F9\uFE0F", text: "\uC74C\uC131 \uC815\uC9C0", color: "red", callback: () => this.plugin.stopSpeaking() },
      { icon: "\u{1F4C2}", text: "\uD3F4\uB354 \uC5F4\uAE30", color: "default", callback: async () => await this.openFolder() }
    ];
    actions.forEach((action) => {
      const button = actionsGrid.createEl("button", {
        text: `${action.icon} ${action.text}`,
        cls: "action-button"
      });
      button.style.backgroundColor = this.getActionColor(action.color);
      button.onclick = action.callback;
    });
    const filesSection = contentEl.createDiv({ cls: "files-section" });
    const filesSectionHeader = filesSection.createDiv({ cls: "files-section-header" });
    filesSectionHeader.createEl("h2", { text: "\u{1F4C4} \uC800\uC7A5\uB41C \uD30C\uC77C" });
    const filterContainer = filesSectionHeader.createDiv({ cls: "filter-container" });
    const filterLabel = filterContainer.createEl("label", { text: "\uD544\uD130: " });
    const filterSelect = filterContainer.createEl("select", { cls: "folder-filter" });
    filterSelect.createEl("option", { text: "\uC804\uCCB4", value: "all" });
    filterSelect.createEl("option", { text: "\u{1F4DD} TXT \uD30C\uC77C", value: "txt" });
    filterSelect.createEl("option", { text: "\u{1F3B5} \uC624\uB514\uC624 \uD30C\uC77C", value: "audio" });
    let currentFilter = "all";
    const renderFilesList = async (filter) => {
      const filesContainer = filesSection.querySelector(".files-container");
      if (filesContainer)
        filesContainer.remove();
      const filesList = await this.getFilesList();
      let filteredFiles = filesList;
      if (filter === "txt") {
        filteredFiles = filesList.filter((f) => f.ext === "txt");
      } else if (filter === "audio") {
        filteredFiles = filesList.filter((f) => ["webm", "mp4", "ogg", "mp3", "wav"].includes(f.ext));
      }
      if (filteredFiles.length === 0) {
        const emptyMsg2 = filesSection.querySelector(".empty-message");
        if (emptyMsg2)
          emptyMsg2.remove();
        filesSection.createEl("p", {
          text: "\u274C \uC800\uC7A5\uB41C \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4.",
          cls: "empty-message"
        });
        return;
      }
      const emptyMsg = filesSection.querySelector(".empty-message");
      if (emptyMsg)
        emptyMsg.remove();
      const newFilesContainer = filesSection.createDiv({ cls: "files-container" });
      filteredFiles.slice(0, 10).forEach((file, index) => {
        const fileItem = newFilesContainer.createDiv({ cls: "file-item" });
        const fileIcon = fileItem.createDiv({ cls: "file-icon" });
        fileIcon.setText(file.ext === "txt" ? "\u{1F4DD}" : "\u{1F3B5}");
        const fileInfo = fileItem.createDiv({ cls: "file-info" });
        const fileName = fileInfo.createEl("div", { text: file.name, cls: "file-name" });
        const fileDate = fileInfo.createEl("div", {
          text: new Date(file.mtime).toLocaleString("ko-KR"),
          cls: "file-date"
        });
        const fileActions = fileItem.createDiv({ cls: "file-actions" });
        if (file.ext === "txt") {
          const playBtn = fileActions.createEl("button", { text: "\u25B6\uFE0F", cls: "file-action-btn play-btn" });
          playBtn.title = "\uC7AC\uC0DD";
          playBtn.onclick = async () => await this.playTxtFile(file.path);
          const convertBtn = fileActions.createEl("button", { text: "\u{1F3B5}", cls: "file-action-btn convert-btn" });
          convertBtn.title = "\uBCC0\uD658";
          convertBtn.onclick = async () => await this.convertTxtToAudio(file.path);
          const openBtn = fileActions.createEl("button", { text: "\u{1F4C2}", cls: "file-action-btn open-btn" });
          openBtn.title = "\uD30C\uC77C \uC5F4\uAE30";
          openBtn.onclick = async () => await this.openFile(file.path);
        } else if (["webm", "mp4", "ogg", "mp3", "wav"].includes(file.ext)) {
          const playBtn = fileActions.createEl("button", { text: "\u25B6\uFE0F", cls: "file-action-btn play-btn" });
          playBtn.title = "\uC7AC\uC0DD";
          playBtn.onclick = async () => await this.playAudioFile(file.path);
          const openBtn = fileActions.createEl("button", { text: "\u{1F4C2}", cls: "file-action-btn open-btn" });
          openBtn.title = "\uD30C\uC77C \uC704\uCE58 \uC5F4\uAE30";
          openBtn.onclick = async () => await this.showInFolder(file.path);
        }
        const renameBtn = fileActions.createEl("button", { text: "\u270F\uFE0F", cls: "file-action-btn rename-btn" });
        renameBtn.title = "\uC774\uB984 \uBC14\uAFB8\uAE30";
        renameBtn.onclick = async () => await this.renameFile(file.path, file.name);
        const deleteBtn = fileActions.createEl("button", { text: "\u{1F5D1}\uFE0F", cls: "file-action-btn delete-btn" });
        deleteBtn.title = "\uC0AD\uC81C";
        deleteBtn.onclick = async () => await this.deleteFile(file.path);
      });
      if (filteredFiles.length > 10) {
        const showMore = filesSection.createEl("button", {
          text: `+${filteredFiles.length - 10}\uAC1C \uB354 \uBCF4\uAE30`,
          cls: "show-more-btn"
        });
        showMore.onclick = async () => await this.openFolder();
      }
    };
    filterSelect.addEventListener("change", async (e) => {
      currentFilter = e.target.value;
      await renderFilesList(currentFilter);
    });
    await renderFilesList(currentFilter);
    const settingsSection = contentEl.createDiv({ cls: "settings-section" });
    settingsSection.createEl("h2", { text: "\u2699\uFE0F \uD604\uC7AC \uC124\uC815" });
    const settingsInfo = settingsSection.createDiv({ cls: "settings-info" });
    settingsInfo.innerHTML = `
            <div class="setting-item">
                <span class="setting-label">\u{1F3B5} \uC74C\uC131 \uBAA8\uB4DC:</span>
                <span class="setting-value">${this.plugin.settings.voiceMode === "browser" ? "\uBE0C\uB77C\uC6B0\uC800 TTS" : "\uCEE4\uC2A4\uD140 \uC74C\uC131"}</span>
            </div>
            <div class="setting-item">
                <span class="setting-label">\u{1F30D} \uC5B8\uC5B4:</span>
                <span class="setting-value">${this.plugin.settings.language}</span>
            </div>
            <div class="setting-item">
                <span class="setting-label">\u{1F4C1} \uCD9C\uB825 \uD3F4\uB354:</span>
                <span class="setting-value">${this.plugin.settings.outputFolder}</span>
            </div>
        `;
    const controlsSection = contentEl.createDiv({ cls: "controls-section" });
    controlsSection.createEl("h2", { text: "\u{1F39B}\uFE0F \uC7AC\uC0DD \uCEE8\uD2B8\uB864" });
    const controlsContainer = controlsSection.createDiv({ cls: "controls-container" });
    const volumeControl = controlsContainer.createDiv({ cls: "control-item" });
    volumeControl.createEl("label", { text: "\u{1F50A} \uBCFC\uB968" });
    const volumeSlider = volumeControl.createEl("input", {
      type: "range",
      attr: { min: "0", max: "1", step: "0.1", value: this.plugin.settings.volume.toString() }
    });
    const volumeValue = volumeControl.createEl("span", {
      text: `${Math.round(this.plugin.settings.volume * 100)}%`,
      cls: "control-value"
    });
    volumeSlider.addEventListener("input", async (e) => {
      const value = parseFloat(e.target.value);
      this.plugin.settings.volume = value;
      await this.plugin.saveSettings();
      volumeValue.setText(`${Math.round(value * 100)}%`);
    });
    const speedControl = controlsContainer.createDiv({ cls: "control-item" });
    speedControl.createEl("label", { text: "\u26A1 \uC18D\uB3C4" });
    const speedSlider = speedControl.createEl("input", {
      type: "range",
      attr: { min: "0.5", max: "4", step: "0.1", value: this.plugin.settings.speed.toString() }
    });
    const speedValue = speedControl.createEl("span", {
      text: `${this.plugin.settings.speed}x`,
      cls: "control-value"
    });
    speedSlider.addEventListener("input", async (e) => {
      const value = parseFloat(e.target.value);
      this.plugin.settings.speed = value;
      await this.plugin.saveSettings();
      speedValue.setText(`${value}x`);
    });
    this.addStyles();
  }
  createStatCard(container, icon, label, value, color) {
    const card = container.createDiv({ cls: "stat-card" });
    card.style.borderLeft = `4px solid ${color}`;
    const cardIcon = card.createDiv({ cls: "stat-icon" });
    cardIcon.setText(icon);
    const cardValue = card.createDiv({ cls: "stat-value" });
    cardValue.setText(value);
    const cardLabel = card.createDiv({ cls: "stat-label" });
    cardLabel.setText(label);
  }
  async getStats() {
    const txtFolder = this.app.vault.getAbstractFileByPath(this.plugin.settings.outputFolder);
    const audioFolder = this.app.vault.getAbstractFileByPath(this.plugin.settings.audioFolder);
    const files = this.app.vault.getFiles();
    const txtFiles = files.filter((f) => f.path.startsWith(this.plugin.settings.outputFolder) && f.extension === "txt").length;
    const audioFiles = files.filter((f) => f.path.startsWith(this.plugin.settings.audioFolder) && ["webm", "mp4", "ogg", "mp3", "wav"].includes(f.extension)).length;
    return { txtFiles, audioFiles, hasProfile: !!this.plugin.settings.customVoiceData };
  }
  async getFilesList() {
    const files = this.app.vault.getFiles();
    console.log("Total files in vault:", files.length);
    console.log("Output folder:", this.plugin.settings.outputFolder);
    console.log("Audio folder:", this.plugin.settings.audioFolder);
    const txtFiles = files.filter((f) => {
      const inOutputFolder = f.path.startsWith(this.plugin.settings.outputFolder);
      const inLegacyFolder = f.path.startsWith("TTS Audio/") && !f.path.startsWith("TTS Audio/Voice");
      return (inOutputFolder || inLegacyFolder) && f.extension === "txt";
    });
    const audioFiles = files.filter((f) => {
      const inAudioFolder = f.path.startsWith(this.plugin.settings.audioFolder);
      const inLegacyFolder = f.path.startsWith("TTS Audio/") && !f.path.startsWith("TTS Audio/Text");
      return (inAudioFolder || inLegacyFolder) && ["webm", "mp4", "ogg", "mp3", "wav"].includes(f.extension);
    });
    console.log("Found TXT files:", txtFiles.length, txtFiles.map((f) => f.path));
    console.log("Found audio files:", audioFiles.length, audioFiles.map((f) => f.path));
    const allFiles = [...txtFiles, ...audioFiles].map((f) => ({
      name: f.basename,
      path: f.path,
      ext: f.extension,
      mtime: f.stat.mtime
    })).sort((a, b) => b.mtime - a.mtime);
    console.log("Returning file list:", allFiles);
    return allFiles;
  }
  async playTxtFile(filePath) {
    try {
      const file = this.app.vault.getAbstractFileByPath(filePath);
      if (file) {
        const content = await this.app.vault.read(file);
        const textContent = this.plugin.extractTextFromTTSFile(content);
        if (textContent) {
          new TTSPlayerModal(this.app, this.plugin, {
            type: "text",
            content: textContent,
            filename: file.basename,
            filePath
          }).open();
        }
      }
    } catch (error) {
      new import_obsidian.Notice("\u274C \uD30C\uC77C \uC7AC\uC0DD \uC2E4\uD328: " + error.message);
    }
  }
  async playAudioFile(filePath) {
    console.log("playAudioFile called with:", filePath);
    try {
      const file = this.app.vault.getAbstractFileByPath(filePath);
      console.log("File object:", file);
      if (!file) {
        new import_obsidian.Notice("\u274C \uD30C\uC77C\uC744 \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4: " + filePath);
        console.error("File not found:", filePath);
        const allFiles = this.app.vault.getFiles();
        console.log("All files in vault:", allFiles.map((f) => f.path));
        console.log("Looking for:", filePath);
        return;
      }
      console.log("Opening player modal for:", file.basename);
      new TTSPlayerModal(this.app, this.plugin, {
        type: "audio",
        filePath,
        filename: file.basename
      }).open();
    } catch (error) {
      new import_obsidian.Notice("\u274C \uD30C\uC77C \uC7AC\uC0DD \uC2E4\uD328: " + error.message);
      console.error("Play audio file error:", error);
    }
  }
  async deleteFile(filePath) {
    if (confirm("\uD30C\uC77C\uC744 \uC0AD\uC81C\uD558\uC2DC\uACA0\uC2B5\uB2C8\uAE4C?")) {
      try {
        const file = this.app.vault.getAbstractFileByPath(filePath);
        if (file) {
          await this.app.vault.delete(file);
          new import_obsidian.Notice("\u2705 \uD30C\uC77C \uC0AD\uC81C\uB428");
          this.onOpen();
        }
      } catch (error) {
        new import_obsidian.Notice("\u274C \uD30C\uC77C \uC0AD\uC81C \uC2E4\uD328: " + error.message);
      }
    }
  }
  async renameFile(filePath, currentName) {
    console.log("Rename called with:", { filePath, currentName });
    const modal = new import_obsidian.Modal(this.app);
    modal.titleEl.setText("\u{1F4DD} \uD30C\uC77C \uC774\uB984 \uBCC0\uACBD");
    const { contentEl } = modal;
    contentEl.style.padding = "20px";
    contentEl.createEl("p", {
      text: "\uC0C8 \uD30C\uC77C \uC774\uB984\uC744 \uC785\uB825\uD558\uC138\uC694 (\uD655\uC7A5\uC790 \uC81C\uC678):",
      cls: "rename-desc"
    }).style.marginBottom = "15px";
    const inputEl = contentEl.createEl("input", {
      type: "text",
      value: currentName
    });
    inputEl.style.width = "100%";
    inputEl.style.padding = "8px 12px";
    inputEl.style.fontSize = "14px";
    inputEl.style.border = "1px solid var(--background-modifier-border)";
    inputEl.style.borderRadius = "6px";
    inputEl.style.marginBottom = "15px";
    setTimeout(() => {
      inputEl.focus();
      inputEl.select();
    }, 100);
    const btnContainer = contentEl.createDiv();
    btnContainer.style.display = "flex";
    btnContainer.style.gap = "10px";
    btnContainer.style.justifyContent = "flex-end";
    const saveBtn = btnContainer.createEl("button", {
      text: "\u{1F4BE} \uC800\uC7A5",
      cls: "mod-cta"
    });
    const cancelBtn = btnContainer.createEl("button", {
      text: "\u274C \uCDE8\uC18C"
    });
    const doRename = async () => {
      const newName = inputEl.value.trim();
      console.log("User entered new name:", newName);
      if (newName && newName !== currentName) {
        try {
          const file = this.app.vault.getAbstractFileByPath(filePath);
          console.log("File found:", file);
          if (!file) {
            new import_obsidian.Notice("\u274C \uD30C\uC77C\uC744 \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4: " + filePath);
            modal.close();
            return;
          }
          const ext = file.extension;
          const parentPath = filePath.substring(0, filePath.lastIndexOf("/"));
          const newPath = `${parentPath}/${newName}.${ext}`;
          console.log("Renaming:", { from: filePath, to: newPath });
          await this.app.vault.rename(file, newPath);
          new import_obsidian.Notice("\u2705 \uD30C\uC77C \uC774\uB984 \uBCC0\uACBD\uB428");
          modal.close();
          this.onOpen();
        } catch (error) {
          new import_obsidian.Notice("\u274C \uD30C\uC77C \uC774\uB984 \uBCC0\uACBD \uC2E4\uD328: " + error.message);
          console.error("Rename error:", error);
          modal.close();
        }
      } else {
        console.log("Rename cancelled or invalid input");
        modal.close();
      }
    };
    saveBtn.addEventListener("click", doRename);
    cancelBtn.addEventListener("click", () => {
      console.log("Rename cancelled");
      modal.close();
    });
    inputEl.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        doRename();
      } else if (e.key === "Escape") {
        modal.close();
      }
    });
    modal.open();
  }
  async openFile(filePath) {
    console.log("openFile called with:", filePath);
    try {
      const file = this.app.vault.getAbstractFileByPath(filePath);
      console.log("File object:", file);
      if (file) {
        console.log("Opening file in leaf...");
        const leaf = this.app.workspace.getLeaf(false);
        await leaf.openFile(file);
        new import_obsidian.Notice("\u{1F4C2} \uD30C\uC77C \uC5F4\uB9BC");
        console.log("\u2705 File opened successfully");
      } else {
        console.error("\u274C File not found:", filePath);
        const allFiles = this.app.vault.getFiles();
        console.log("All files in vault:", allFiles.length);
        console.log("Looking for:", filePath);
        const similarFiles = allFiles.filter(
          (f) => f.path.includes(filePath) || filePath.includes(f.basename)
        );
        console.log("Similar files:", similarFiles.map((f) => f.path));
        new import_obsidian.Notice("\u274C \uD30C\uC77C\uC744 \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.");
      }
    } catch (error) {
      console.error("openFile error:", error);
      console.error("Error stack:", error.stack);
      new import_obsidian.Notice("\u274C \uD30C\uC77C \uC5F4\uAE30 \uC2E4\uD328: " + error.message);
    }
  }
  async showInFolder(filePath) {
    var _a;
    try {
      const adapter = this.app.vault.adapter;
      if (adapter && "getBasePath" in adapter) {
        const basePath = adapter.getBasePath();
        const absolutePath = `${basePath}/${filePath}`.replace(/\//g, "\\");
        if (isElectronApp() && typeof window.require === "function") {
          try {
            const electron = window.require("electron");
            const shell = ((_a = electron.remote) == null ? void 0 : _a.shell) || electron.shell;
            shell.showItemInFolder(absolutePath);
            new import_obsidian.Notice("\u{1F4C2} \uD30C\uC77C \uC704\uCE58 \uC5F4\uB9BC (\uD0D0\uC0C9\uAE30)");
          } catch (e) {
            console.error("electron showItemInFolder error:", e);
            new import_obsidian.Notice("\u274C \uD30C\uC77C \uC704\uCE58 \uC5F4\uAE30 \uC2E4\uD328: " + e.message);
          }
        } else {
          const file = this.app.vault.getAbstractFileByPath(filePath);
          if (file) {
            const leaf = this.app.workspace.getLeaf(false);
            await leaf.openFile(file);
            new import_obsidian.Notice("\u{1F4DD} Obsidian\uC5D0\uC11C \uD30C\uC77C \uC5F4\uB9BC");
          } else {
            new import_obsidian.Notice("\uBAA8\uBC14\uC77C\uC5D0\uC11C\uB294 \uC678\uBD80 \uD0D0\uC0C9\uAE30 \uC5F4\uAE30\uAC00 \uC9C0\uC6D0\uB418\uC9C0 \uC54A\uC2B5\uB2C8\uB2E4. \uD30C\uC77C\uC744 \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.");
          }
        }
      }
    } catch (error) {
      new import_obsidian.Notice("\u274C \uD30C\uC77C \uC704\uCE58 \uC5F4\uAE30 \uC2E4\uD328: " + error.message);
      console.error("Show in folder error:", error);
    }
  }
  async openFolder() {
    var _a;
    try {
      const folderPath = this.plugin.settings.outputFolder;
      const folder = this.app.vault.getAbstractFileByPath(folderPath);
      if (!folder) {
        await this.app.vault.createFolder(folderPath).catch(() => {
        });
      }
      const adapter = this.app.vault.adapter;
      if (adapter && "getBasePath" in adapter) {
        const basePath = adapter.getBasePath();
        const absolutePath = `${basePath}/${folderPath}`.replace(/\//g, "\\");
        if (isElectronApp() && typeof window.require === "function") {
          try {
            const electron = window.require("electron");
            const shell = ((_a = electron.remote) == null ? void 0 : _a.shell) || electron.shell;
            await shell.openPath(absolutePath);
            new import_obsidian.Notice(`\u{1F4C2} \uD3F4\uB354 \uC5F4\uB9BC: ${folderPath} (\uD0D0\uC0C9\uAE30)`);
          } catch (e) {
            console.error("electron openPath error:", e);
            new import_obsidian.Notice("\u274C \uD3F4\uB354 \uC5F4\uAE30 \uC2E4\uD328: " + e.message);
          }
        } else {
          const files = this.app.vault.getMarkdownFiles().filter((f) => f.path.startsWith(folderPath));
          if (files.length > 0) {
            const firstFile = files[0];
            const leaf = this.app.workspace.getLeaf(false);
            await leaf.openFile(firstFile);
            new import_obsidian.Notice(`\u{1F4DD} Obsidian\uC5D0\uC11C \uD3F4\uB354\uC758 \uCCAB \uD30C\uC77C\uC744 \uC5F4\uC5C8\uC2B5\uB2C8\uB2E4 (${firstFile.path})`);
          } else {
            new import_obsidian.Notice("\uBAA8\uBC14\uC77C\uC5D0\uC11C\uB294 \uC678\uBD80 \uD30C\uC77C \uD0D0\uC0C9\uAE30\uB97C \uC5F4 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4. \uD574\uB2F9 \uD3F4\uB354\uC5D0 \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4.");
          }
        }
      } else {
        new import_obsidian.Notice("\u274C \uD3F4\uB354 \uACBD\uB85C\uB97C \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.");
      }
    } catch (error) {
      new import_obsidian.Notice("\u274C \uD3F4\uB354 \uC5F4\uAE30 \uC2E4\uD328: " + error.message);
      console.error("Open folder error:", error);
    }
  }
  async convertTxtToAudio(filePath) {
    try {
      const file = this.app.vault.getAbstractFileByPath(filePath);
      if (!file) {
        new import_obsidian.Notice("\u274C \uD30C\uC77C\uC744 \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.");
        return;
      }
      const content = await this.app.vault.read(file);
      const textContent = this.plugin.extractTextFromTTSFile(content);
      if (!textContent) {
        new import_obsidian.Notice("\u274C \uBCC0\uD658\uD560 \uD14D\uC2A4\uD2B8\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4.");
        return;
      }
      new LanguageSelectModal(this.app, this.plugin, textContent, file.basename).open();
    } catch (error) {
      new import_obsidian.Notice("\u274C \uBCC0\uD658 \uC2E4\uD328: " + error.message);
      console.error("Convert error:", error);
    }
  }
  getActionColor(color) {
    const colors = {
      blue: "var(--interactive-accent)",
      green: "#4caf50",
      red: "#f44336",
      default: "var(--background-modifier-border)"
    };
    return colors[color] || colors.default;
  }
  addStyles() {
    const style = document.createElement("style");
    style.textContent = `
            .tts-dashboard-modal {
                padding: 20px;
                max-width: 800px;
            }
            
            .dashboard-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 30px;
            }
            
            .header-title h1 {
                margin: 0;
                color: var(--text-accent);
            }
            
            .header-actions {
                display: flex;
                gap: 10px;
            }
            
            .settings-btn {
                padding: 8px 16px;
                background: var(--interactive-accent);
                color: white;
                border: none;
                border-radius: 6px;
                cursor: pointer;
                font-size: 14px;
                transition: all 0.2s;
            }
            
            .settings-btn:hover {
                opacity: 0.8;
                transform: translateY(-2px);
            }
            
            .stats-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
                gap: 15px;
                margin-bottom: 30px;
            }
            
            .stat-card {
                padding: 20px;
                background: var(--background-secondary);
                border-radius: 8px;
                text-align: center;
                transition: transform 0.2s;
            }
            
            .stat-card:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            }
            
            .stat-icon {
                font-size: 32px;
                margin-bottom: 10px;
            }
            
            .stat-value {
                font-size: 24px;
                font-weight: bold;
                margin-bottom: 5px;
                color: var(--text-normal);
            }
            
            .stat-label {
                font-size: 14px;
                color: var(--text-muted);
            }
            
            .actions-section, .files-section, .settings-section {
                margin-bottom: 30px;
            }
            
            .files-section-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 15px;
            }
            
            .files-section-header h2 {
                margin: 0;
            }
            
            .filter-container {
                display: flex;
                align-items: center;
                gap: 8px;
            }
            
            .filter-container label {
                font-size: 14px;
                color: var(--text-muted);
            }
            
            .folder-filter {
                padding: 4px 8px;
                border-radius: 4px;
                border: 1px solid var(--background-modifier-border);
                background: var(--background-secondary);
                color: var(--text-normal);
                cursor: pointer;
                font-size: 13px;
            }
            
            .folder-filter:hover {
                border-color: var(--interactive-accent);
            }
            
            .actions-section h2, .files-section h2, .settings-section h2 {
                font-size: 18px;
                color: var(--text-normal);
            }
            
            .actions-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 10px;
            }
            
            .action-button {
                padding: 15px;
                font-size: 14px;
                border-radius: 8px;
                border: none;
                color: white;
                cursor: pointer;
                transition: all 0.2s;
                font-weight: 500;
            }
            
            .action-button:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            }
            
            .files-container {
                display: flex;
                flex-direction: column;
                gap: 8px;
            }
            
            .file-item {
                display: flex;
                align-items: center;
                gap: 12px;
                padding: 12px;
                background: var(--background-secondary);
                border-radius: 8px;
                transition: background 0.2s;
            }
            
            .file-item:hover {
                background: var(--background-modifier-hover);
            }
            
            .file-icon {
                font-size: 24px;
                flex-shrink: 0;
            }
            
            .file-info {
                flex: 1;
                min-width: 0;
            }
            
            .file-name {
                font-weight: 500;
                color: var(--text-normal);
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }
            
            .file-date {
                font-size: 12px;
                color: var(--text-muted);
                margin-top: 2px;
            }
            
            .file-actions {
                display: flex;
                gap: 5px;
            }
            
            .file-action-btn {
                padding: 6px 12px;
                font-size: 14px;
                border-radius: 5px;
                border: none;
                cursor: pointer;
                transition: all 0.2s;
                min-width: 36px;
            }
            
            .play-btn {
                background: #4caf50;
                color: white;
            }
            
            .play-btn:hover {
                background: #45a049;
            }
            
            .convert-btn {
                background: #2196f3;
                color: white;
            }
            
            .convert-btn:hover {
                background: #1976d2;
            }
            
            .open-btn {
                background: #ff9800;
                color: white;
            }
            
            .open-btn:hover {
                background: #f57c00;
            }
            
            .rename-btn {
                background: #9c27b0;
                color: white;
            }
            
            .rename-btn:hover {
                background: #7b1fa2;
            }
            
            .delete-btn {
                background: var(--background-modifier-border);
                color: var(--text-normal);
            }
            
            .delete-btn:hover {
                background: #f44336;
                color: white;
            }
            
            .show-more-btn {
                width: 100%;
                padding: 10px;
                margin-top: 10px;
                background: var(--background-modifier-border);
                border: none;
                border-radius: 5px;
                cursor: pointer;
                color: var(--text-muted);
            }
            
            .show-more-btn:hover {
                background: var(--background-modifier-hover);
            }
            
            .empty-message {
                text-align: center;
                color: var(--text-muted);
                padding: 20px;
            }
            
            .settings-info {
                background: var(--background-secondary);
                padding: 15px;
                border-radius: 8px;
            }
            
            .setting-item {
                display: flex;
                justify-content: space-between;
                padding: 8px 0;
                border-bottom: 1px solid var(--background-modifier-border);
            }
            
            .setting-item:last-child {
                border-bottom: none;
            }
            
            .setting-label {
                color: var(--text-muted);
                font-size: 14px;
            }
            
            .setting-value {
                color: var(--text-normal);
                font-weight: 500;
                font-size: 14px;
            }
            
            .controls-section {
                margin-bottom: 30px;
            }
            
            .controls-container {
                background: var(--background-secondary);
                padding: 20px;
                border-radius: 8px;
            }
            
            .control-item {
                display: flex;
                align-items: center;
                gap: 15px;
                margin-bottom: 20px;
            }
            
            .control-item:last-child {
                margin-bottom: 0;
            }
            
            .control-item label {
                min-width: 80px;
                font-weight: 500;
                color: var(--text-normal);
            }
            
            .control-item input[type="range"] {
                flex: 1;
                height: 6px;
                border-radius: 3px;
                background: var(--background-modifier-border);
                outline: none;
                -webkit-appearance: none;
            }
            
            .control-item input[type="range"]::-webkit-slider-thumb {
                -webkit-appearance: none;
                appearance: none;
                width: 18px;
                height: 18px;
                border-radius: 50%;
                background: var(--interactive-accent);
                cursor: pointer;
                transition: all 0.2s;
            }
            
            .control-item input[type="range"]::-webkit-slider-thumb:hover {
                transform: scale(1.2);
                box-shadow: 0 0 0 4px rgba(var(--interactive-accent-rgb), 0.2);
            }
            
            .control-item input[type="range"]::-moz-range-thumb {
                width: 18px;
                height: 18px;
                border-radius: 50%;
                background: var(--interactive-accent);
                cursor: pointer;
                border: none;
                transition: all 0.2s;
            }
            
            .control-item input[type="range"]::-moz-range-thumb:hover {
                transform: scale(1.2);
                box-shadow: 0 0 0 4px rgba(var(--interactive-accent-rgb), 0.2);
            }
            
            .control-value {
                min-width: 60px;
                text-align: right;
                font-weight: bold;
                color: var(--interactive-accent);
            }
            
            /* \uBAA8\uBC14\uC77C \uBC18\uC751\uD615 \uCD5C\uC801\uD654 */
            @media (max-width: 768px) {
                .tts-dashboard-modal {
                    padding: 15px;
                    max-width: 100%;
                }
                
                .dashboard-header {
                    flex-direction: column;
                    gap: 15px;
                    align-items: flex-start;
                    margin-bottom: 20px;
                }
                
                .header-actions {
                    width: 100%;
                }
                
                .settings-btn {
                    width: 100%;
                    justify-content: center;
                }
                
                .stats-grid {
                    grid-template-columns: 1fr;
                    gap: 10px;
                }
                
                .actions-grid {
                    grid-template-columns: 1fr;
                    gap: 8px;
                }
                
                .action-button {
                    padding: 12px;
                    font-size: 13px;
                }
                
                .file-item {
                    flex-direction: column;
                    align-items: flex-start;
                    padding: 10px;
                }
                
                .file-actions {
                    width: 100%;
                    justify-content: flex-start;
                    flex-wrap: wrap;
                }
                
                .file-action-btn {
                    flex: 1;
                    min-width: 60px;
                    padding: 8px;
                    font-size: 13px;
                }
                
                .controls-container {
                    padding: 15px;
                }
                
                .control-item {
                    flex-direction: column;
                    align-items: stretch;
                    gap: 8px;
                }
                
                .control-item label {
                    min-width: auto;
                }
                
                .control-value {
                    text-align: left;
                }
            }
            
            @media (max-width: 480px) {
                .tts-dashboard-modal {
                    padding: 10px;
                }
                
                .header-title h1 {
                    font-size: 20px;
                }
                
                .stat-card {
                    padding: 15px;
                }
                
                .stat-icon {
                    font-size: 24px;
                }
                
                .stat-value {
                    font-size: 20px;
                }
                
                .file-name {
                    font-size: 14px;
                }
                
                .file-date {
                    font-size: 11px;
                }
                
                .filter-container {
                    flex-direction: column;
                    align-items: stretch;
                    gap: 5px;
                }
                
                .folder-filter {
                    width: 100%;
                }
            }
            
            /* \uD130\uCE58 \uB514\uBC14\uC774\uC2A4 \uCD5C\uC801\uD654 */
            @media (hover: none) and (pointer: coarse) {
                .action-button,
                .file-action-btn,
                .settings-btn {
                    min-height: 44px;
                    padding: 12px 16px;
                }
                
                .file-action-btn:active {
                    transform: scale(0.95);
                }
                
                .action-button:active {
                    transform: translateY(0);
                }
            }
        `;
    document.head.appendChild(style);
  }
  onClose() {
    const { contentEl } = this;
    contentEl.empty();
  }
};
var LanguageSelectModal = class extends import_obsidian.Modal {
  constructor(app, plugin, textContent, filename) {
    super(app);
    this.plugin = plugin;
    this.textContent = textContent;
    this.filename = filename;
    this.selectedLanguage = plugin.settings.language;
    this.selectedVoice = plugin.settings.browserVoice;
  }
  async onOpen() {
    const { contentEl } = this;
    contentEl.empty();
    contentEl.addClass("language-select-modal");
    contentEl.createEl("h2", { text: "\u{1F3B5} \uD14D\uC2A4\uD2B8 \u2192 \uC74C\uC131 \uBCC0\uD658" });
    const fileInfo = contentEl.createDiv({ cls: "file-info-section" });
    fileInfo.createEl("p", {
      text: `\u{1F4C4} \uD30C\uC77C: ${this.filename}`,
      cls: "info-text"
    });
    fileInfo.createEl("p", {
      text: `\u{1F4DD} \uD14D\uC2A4\uD2B8 \uAE38\uC774: ${this.textContent.length}\uC790`,
      cls: "info-text"
    });
    const languageSection = contentEl.createDiv({ cls: "setting-section" });
    languageSection.createEl("h3", { text: "\u{1F30D} \uC5B8\uC5B4 \uC120\uD0DD" });
    const languages = [
      { code: "ko-KR", name: "\uD55C\uAD6D\uC5B4 (Korean)" },
      { code: "en-US", name: "\uC601\uC5B4 - \uBBF8\uAD6D (English - US)" },
      { code: "en-GB", name: "\uC601\uC5B4 - \uC601\uAD6D (English - UK)" },
      { code: "ja-JP", name: "\uC77C\uBCF8\uC5B4 (Japanese)" },
      { code: "zh-CN", name: "\uC911\uAD6D\uC5B4 - \uAC04\uCCB4 (Chinese - Simplified)" },
      { code: "zh-TW", name: "\uC911\uAD6D\uC5B4 - \uBC88\uCCB4 (Chinese - Traditional)" },
      { code: "es-ES", name: "\uC2A4\uD398\uC778\uC5B4 (Spanish)" },
      { code: "fr-FR", name: "\uD504\uB791\uC2A4\uC5B4 (French)" },
      { code: "de-DE", name: "\uB3C5\uC77C\uC5B4 (German)" },
      { code: "ru-RU", name: "\uB7EC\uC2DC\uC544\uC5B4 (Russian)" },
      { code: "pt-BR", name: "\uD3EC\uB974\uD22C\uAC08\uC5B4 - \uBE0C\uB77C\uC9C8 (Portuguese - Brazil)" },
      { code: "it-IT", name: "\uC774\uD0C8\uB9AC\uC544\uC5B4 (Italian)" },
      { code: "ar-SA", name: "\uC544\uB78D\uC5B4 (Arabic)" },
      { code: "hi-IN", name: "\uD78C\uB514\uC5B4 (Hindi)" },
      { code: "th-TH", name: "\uD0DC\uAD6D\uC5B4 (Thai)" },
      { code: "vi-VN", name: "\uBCA0\uD2B8\uB0A8\uC5B4 (Vietnamese)" }
    ];
    const languageDropdown = languageSection.createEl("select", { cls: "language-dropdown" });
    languages.forEach((lang) => {
      const option = languageDropdown.createEl("option", {
        text: lang.name,
        value: lang.code
      });
      if (lang.code === this.selectedLanguage) {
        option.selected = true;
      }
    });
    languageDropdown.addEventListener("change", () => {
      this.selectedLanguage = languageDropdown.value;
      this.updateVoiceList(voiceDropdown);
    });
    const voiceSection = contentEl.createDiv({ cls: "setting-section" });
    voiceSection.createEl("h3", { text: "\u{1F3A4} \uC74C\uC131 \uC120\uD0DD" });
    const voiceDropdown = voiceSection.createEl("select", { cls: "voice-dropdown" });
    this.updateVoiceList(voiceDropdown);
    voiceDropdown.addEventListener("change", () => {
      this.selectedVoice = voiceDropdown.value;
    });
    const settingsSection = contentEl.createDiv({ cls: "setting-section" });
    settingsSection.createEl("h3", { text: "\u2699\uFE0F \uC74C\uC131 \uC124\uC815" });
    const speedControl = settingsSection.createDiv({ cls: "control-row" });
    speedControl.createEl("label", { text: "\uC18D\uB3C4:" });
    const speedSlider = speedControl.createEl("input", {
      type: "range",
      attr: { min: "0.5", max: "4", step: "0.1", value: this.plugin.settings.speed.toString() }
    });
    const speedValue = speedControl.createEl("span", { text: `${this.plugin.settings.speed}x`, cls: "control-value" });
    speedSlider.addEventListener("input", (e) => {
      const value = parseFloat(e.target.value);
      speedValue.setText(`${value}x`);
    });
    const volumeControl = settingsSection.createDiv({ cls: "control-row" });
    volumeControl.createEl("label", { text: "\uBCFC\uB968:" });
    const volumeSlider = volumeControl.createEl("input", {
      type: "range",
      attr: { min: "0", max: "1", step: "0.1", value: this.plugin.settings.volume.toString() }
    });
    const volumeValue = volumeControl.createEl("span", { text: `${Math.round(this.plugin.settings.volume * 100)}%`, cls: "control-value" });
    volumeSlider.addEventListener("input", (e) => {
      const value = parseFloat(e.target.value);
      volumeValue.setText(`${Math.round(value * 100)}%`);
    });
    const buttonContainer = contentEl.createDiv({ cls: "button-container" });
    const previewBtn = buttonContainer.createEl("button", {
      text: "\u{1F50A} \uBBF8\uB9AC\uB4E3\uAE30",
      cls: "preview-button"
    });
    previewBtn.onclick = () => {
      const preview = this.textContent.substring(0, 200);
      this.playPreview(preview, speedSlider.value, volumeSlider.value);
    };
    const convertBtn = buttonContainer.createEl("button", {
      text: "\u{1F3B5} \uBCC0\uD658 \uC2DC\uC791",
      cls: "mod-cta convert-button"
    });
    convertBtn.onclick = async () => {
      await this.convertToAudio(speedSlider.value, volumeSlider.value);
    };
    const cancelBtn = buttonContainer.createEl("button", {
      text: "\u274C \uCDE8\uC18C"
    });
    cancelBtn.onclick = () => this.close();
    this.addStyles();
  }
  updateVoiceList(dropdown) {
    dropdown.empty();
    const availableVoices = this.plugin.availableVoices.filter(
      (v) => v.lang.startsWith(this.selectedLanguage.split("-")[0])
    );
    if (availableVoices.length === 0) {
      dropdown.createEl("option", { text: "\uC0AC\uC6A9 \uAC00\uB2A5\uD55C \uC74C\uC131 \uC5C6\uC74C", value: "" });
    } else {
      availableVoices.forEach((voice) => {
        const option = dropdown.createEl("option", {
          text: `${voice.name} (${voice.lang})`,
          value: voice.name
        });
        if (voice.name === this.selectedVoice) {
          option.selected = true;
        }
      });
    }
  }
  playPreview(text, speed, volume) {
    const utterance = new SpeechSynthesisUtterance(text);
    const voice = this.plugin.availableVoices.find((v) => v.name === this.selectedVoice);
    if (voice) {
      utterance.voice = voice;
    }
    utterance.rate = parseFloat(speed);
    utterance.volume = parseFloat(volume);
    utterance.lang = this.selectedLanguage;
    this.plugin.synthesis.cancel();
    this.plugin.synthesis.speak(utterance);
    new import_obsidian.Notice("\u{1F50A} \uBBF8\uB9AC\uB4E3\uAE30 \uC7AC\uC0DD \uC911...");
  }
  async convertToAudio(speed, volume) {
    new import_obsidian.Notice("\u{1F3B5} \uC74C\uC131 \uBCC0\uD658 \uC2DC\uC791...");
    try {
      const utterance = new SpeechSynthesisUtterance(this.textContent);
      const voice = this.plugin.availableVoices.find((v) => v.name === this.selectedVoice);
      if (voice) {
        utterance.voice = voice;
      }
      utterance.rate = parseFloat(speed);
      utterance.volume = parseFloat(volume);
      utterance.lang = this.selectedLanguage;
      this.plugin.synthesis.cancel();
      utterance.onstart = () => {
        new import_obsidian.Notice("\u{1F399}\uFE0F \uC74C\uC131 \uC0DD\uC131 \uC911... (\uBE0C\uB77C\uC6B0\uC800 TTS)");
      };
      utterance.onend = async () => {
        new import_obsidian.Notice("\u2705 \uC74C\uC131 \uC0DD\uC131 \uC644\uB8CC!");
        this.close();
      };
      utterance.onerror = (error) => {
        new import_obsidian.Notice("\u274C \uC74C\uC131 \uBCC0\uD658 \uC2E4\uD328: " + error.error);
        console.error("TTS error:", error);
      };
      this.plugin.synthesis.speak(utterance);
      new import_obsidian.Notice("\u2139\uFE0F \uBE0C\uB77C\uC6B0\uC800 TTS\uB294 \uC9C1\uC811 \uD30C\uC77C \uC800\uC7A5\uC744 \uC9C0\uC6D0\uD558\uC9C0 \uC54A\uC2B5\uB2C8\uB2E4. \uC74C\uC131\uC774 \uC7AC\uC0DD\uB429\uB2C8\uB2E4.");
    } catch (error) {
      new import_obsidian.Notice("\u274C \uBCC0\uD658 \uC2E4\uD328: " + error.message);
      console.error("Convert error:", error);
    }
  }
  addStyles() {
    const style = document.createElement("style");
    style.textContent = `
            .language-select-modal {
                padding: 20px;
                max-width: 600px;
            }
            
            .file-info-section {
                background: var(--background-secondary);
                padding: 15px;
                border-radius: 8px;
                margin-bottom: 20px;
            }
            
            .info-text {
                margin: 5px 0;
                color: var(--text-muted);
            }
            
            .setting-section {
                margin-bottom: 20px;
            }
            
            .setting-section h3 {
                margin-bottom: 10px;
                color: var(--text-normal);
            }
            
            .language-dropdown,
            .voice-dropdown {
                width: 100%;
                padding: 10px;
                border-radius: 5px;
                background: var(--background-secondary);
                border: 1px solid var(--background-modifier-border);
                color: var(--text-normal);
                font-size: 14px;
            }
            
            .control-row {
                display: flex;
                align-items: center;
                gap: 15px;
                margin-bottom: 15px;
            }
            
            .control-row label {
                min-width: 60px;
                font-weight: 500;
            }
            
            .control-row input[type="range"] {
                flex: 1;
            }
            
            .control-row .control-value {
                min-width: 50px;
                text-align: right;
                font-weight: bold;
                color: var(--interactive-accent);
            }
            
            .button-container {
                display: flex;
                gap: 10px;
                justify-content: flex-end;
                margin-top: 20px;
            }
            
            .button-container button {
                padding: 10px 20px;
                border-radius: 5px;
                cursor: pointer;
            }
            
            .preview-button {
                background: var(--interactive-accent);
                color: white;
                border: none;
            }
            
            .preview-button:hover {
                opacity: 0.8;
            }
            
            .convert-button {
                background: var(--interactive-accent);
                color: white;
                border: none;
            }
            
            /* \uBAA8\uBC14\uC77C \uBC18\uC751\uD615 \uCD5C\uC801\uD654 */
            @media (max-width: 768px) {
                .language-select-modal {
                    padding: 15px;
                    max-width: 95vw;
                }
                
                .file-info-section {
                    padding: 12px;
                }
                
                .control-row {
                    flex-direction: column;
                    align-items: stretch;
                    gap: 8px;
                }
                
                .control-row label {
                    min-width: auto;
                }
                
                .control-row .control-value {
                    text-align: left;
                }
                
                .button-container {
                    flex-direction: column;
                    gap: 8px;
                }
                
                .button-container button {
                    width: 100%;
                    padding: 12px;
                }
            }
            
            @media (max-width: 480px) {
                .language-select-modal {
                    padding: 10px;
                }
                
                .setting-section h3 {
                    font-size: 16px;
                }
                
                .language-dropdown,
                .voice-dropdown {
                    font-size: 13px;
                    padding: 8px;
                }
            }
            
            /* \uD130\uCE58 \uB514\uBC14\uC774\uC2A4 \uCD5C\uC801\uD654 */
            @media (hover: none) and (pointer: coarse) {
                .button-container button {
                    min-height: 44px;
                    padding: 12px 20px;
                }
                
                .language-dropdown,
                .voice-dropdown {
                    min-height: 44px;
                }
            }
        `;
    document.head.appendChild(style);
  }
  onClose() {
    const { contentEl } = this;
    contentEl.empty();
    this.plugin.synthesis.cancel();
  }
};
var TTSPlayerModal = class extends import_obsidian.Modal {
  constructor(app, plugin, playerData) {
    super(app);
    this.currentUtterance = null;
    this.currentAudio = null;
    this.isPlaying = false;
    this.currentTime = 0;
    this.duration = 0;
    this.progressInterval = null;
    this.plugin = plugin;
    this.playerData = playerData;
  }
  async onOpen() {
    const { contentEl } = this;
    contentEl.empty();
    contentEl.addClass("tts-player-modal");
    const header = contentEl.createDiv({ cls: "player-header" });
    header.createEl("h2", { text: "\u{1F3B5} TTS \uD50C\uB808\uC774\uC5B4" });
    const fileInfo = contentEl.createDiv({ cls: "player-file-info" });
    fileInfo.createEl("div", {
      text: `\u{1F4C4} ${this.playerData.filename}`,
      cls: "player-filename"
    });
    if (this.playerData.type === "text") {
      fileInfo.createEl("div", {
        text: `\u{1F4DD} ${this.playerData.content.length}\uC790`,
        cls: "player-filesize"
      });
    }
    const progressSection = contentEl.createDiv({ cls: "player-progress-section" });
    const progressBar = progressSection.createDiv({ cls: "player-progress-bar" });
    const progressFill = progressBar.createDiv({ cls: "player-progress-fill" });
    this.progressFill = progressFill;
    const timeDisplay = progressSection.createDiv({ cls: "player-time-display" });
    this.timeDisplay = timeDisplay;
    this.updateTimeDisplay();
    const controls = contentEl.createDiv({ cls: "player-controls" });
    const playPauseBtn = controls.createEl("button", {
      text: "\u25B6\uFE0F \uC7AC\uC0DD",
      cls: "player-btn play-pause-btn"
    });
    this.playPauseBtn = playPauseBtn;
    playPauseBtn.onclick = async () => {
      if (this.isPlaying) {
        this.pause();
      } else {
        await this.play();
      }
    };
    const stopBtn = controls.createEl("button", {
      text: "\u23F9\uFE0F \uC815\uC9C0",
      cls: "player-btn stop-btn"
    });
    stopBtn.onclick = () => {
      this.stop();
    };
    const openInObsidianBtn = controls.createEl("button", {
      text: "\u{1F4DD} Obsidian\uC5D0\uC11C \uC5F4\uAE30",
      cls: "player-btn open-obsidian-btn"
    });
    openInObsidianBtn.onclick = async () => {
      if (this.playerData.filePath) {
        console.log("\u{1F4DD} Opening file in Obsidian:", this.playerData.filePath);
        try {
          const file = this.app.vault.getAbstractFileByPath(this.playerData.filePath);
          console.log("File object:", file);
          if (file) {
            const leaf = this.app.workspace.getLeaf(false);
            await leaf.openFile(file);
            new import_obsidian.Notice("\u{1F4DD} Obsidian\uC5D0\uC11C \uD30C\uC77C \uC5F4\uB9BC");
            console.log("\u2705 File opened in Obsidian");
          } else {
            console.error("\u274C File not found:", this.playerData.filePath);
            new import_obsidian.Notice("\u274C \uD30C\uC77C\uC744 \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.");
          }
        } catch (error) {
          console.error("openInObsidian error:", error);
          new import_obsidian.Notice("\u274C \uD30C\uC77C \uC5F4\uAE30 \uC2E4\uD328: " + error.message);
        }
      }
    };
    const openFolderBtn = controls.createEl("button", {
      text: "\u{1F4C2} \uD3F4\uB354 \uC5F4\uAE30",
      cls: "player-btn open-folder-btn"
    });
    openFolderBtn.onclick = async () => {
      var _a, _b;
      console.log("\u{1F4C2} Opening folder in Explorer");
      try {
        if (this.playerData.filePath) {
          const adapter = this.app.vault.adapter;
          if (adapter && "getBasePath" in adapter) {
            const basePath = adapter.getBasePath();
            const absolutePath = `${basePath}/${this.playerData.filePath}`.replace(/\//g, "\\");
            console.log("Opening in explorer:", absolutePath);
            if (isElectronApp() && typeof window.require === "function") {
              try {
                const electron = window.require("electron");
                const shell = ((_a = electron.remote) == null ? void 0 : _a.shell) || electron.shell;
                shell.showItemInFolder(absolutePath);
                new import_obsidian.Notice("\u{1F4C2} \uD30C\uC77C \uC704\uCE58 \uC5F4\uB9BC (\uD0D0\uC0C9\uAE30)");
                console.log("\u2705 Folder opened in Explorer");
              } catch (e) {
                console.error("electron showItemInFolder error:", e);
                new import_obsidian.Notice("\u274C \uD0D0\uC0C9\uAE30 \uC5F4\uAE30 \uC2E4\uD328: " + e.message);
              }
            } else {
              const file = this.app.vault.getAbstractFileByPath(this.playerData.filePath);
              if (file) {
                const leaf = this.app.workspace.getLeaf(false);
                await leaf.openFile(file);
                new import_obsidian.Notice("\uFFFD Obsidian\uC5D0\uC11C \uD30C\uC77C \uC5F4\uB9BC");
              } else {
                new import_obsidian.Notice("\uBAA8\uBC14\uC77C\uC5D0\uC11C\uB294 \uC678\uBD80 \uD0D0\uC0C9\uAE30\uB97C \uC5F4 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.");
              }
            }
          }
        } else {
          const folderPath = this.plugin.settings.outputFolder;
          console.log("Opening output folder:", folderPath);
          if (isElectronApp() && typeof window.require === "function") {
            try {
              const electron = window.require("electron");
              const shell = ((_b = electron.remote) == null ? void 0 : _b.shell) || electron.shell;
              await shell.openPath(folderPath);
              new import_obsidian.Notice("\u{1F4C2} \uD3F4\uB354 \uC5F4\uB9BC (\uD0D0\uC0C9\uAE30)");
            } catch (e) {
              console.error("electron openPath error:", e);
              new import_obsidian.Notice("\u274C \uD3F4\uB354 \uC5F4\uAE30 \uC2E4\uD328: " + e.message);
            }
          } else {
            new import_obsidian.Notice("\uBAA8\uBC14\uC77C\uC5D0\uC11C\uB294 \uC678\uBD80 \uD3F4\uB354\uB97C \uC5F4 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.");
          }
        }
      } catch (error) {
        console.error("openFolder error:", error);
        new import_obsidian.Notice("\u274C \uD3F4\uB354 \uC5F4\uAE30 \uC2E4\uD328: " + error.message);
      }
    };
    if (this.playerData.type === "text") {
      const settingsSection = contentEl.createDiv({ cls: "player-settings-section" });
      settingsSection.createEl("h3", { text: "\u2699\uFE0F \uC7AC\uC0DD \uC124\uC815" });
      const speedControl = settingsSection.createDiv({ cls: "player-control-row" });
      speedControl.createEl("label", { text: "\uC18D\uB3C4:" });
      const speedSlider = speedControl.createEl("input", {
        type: "range",
        attr: { min: "0.5", max: "4", step: "0.1", value: this.plugin.settings.speed.toString() }
      });
      const speedValue = speedControl.createEl("span", {
        text: `${this.plugin.settings.speed}x`,
        cls: "player-control-value"
      });
      speedSlider.addEventListener("input", (e) => {
        const value = parseFloat(e.target.value);
        speedValue.setText(`${value}x`);
        if (this.currentUtterance) {
          this.currentUtterance.rate = value;
        }
      });
      const volumeControl = settingsSection.createDiv({ cls: "player-control-row" });
      volumeControl.createEl("label", { text: "\uBCFC\uB968:" });
      const volumeSlider = volumeControl.createEl("input", {
        type: "range",
        attr: { min: "0", max: "1", step: "0.1", value: this.plugin.settings.volume.toString() }
      });
      const volumeValue = volumeControl.createEl("span", {
        text: `${Math.round(this.plugin.settings.volume * 100)}%`,
        cls: "player-control-value"
      });
      volumeSlider.addEventListener("input", (e) => {
        const value = parseFloat(e.target.value);
        volumeValue.setText(`${Math.round(value * 100)}%`);
        if (this.currentUtterance) {
          this.currentUtterance.volume = value;
        }
      });
      this.speedSlider = speedSlider;
      this.volumeSlider = volumeSlider;
    } else if (this.playerData.type === "audio") {
      const settingsSection = contentEl.createDiv({ cls: "player-settings-section" });
      settingsSection.createEl("h3", { text: "\u2699\uFE0F \uC7AC\uC0DD \uC124\uC815" });
      const volumeControl = settingsSection.createDiv({ cls: "player-control-row" });
      volumeControl.createEl("label", { text: "\uBCFC\uB968:" });
      const volumeSlider = volumeControl.createEl("input", {
        type: "range",
        attr: { min: "0", max: "1", step: "0.1", value: this.plugin.settings.volume.toString() }
      });
      const volumeValue = volumeControl.createEl("span", {
        text: `${Math.round(this.plugin.settings.volume * 100)}%`,
        cls: "player-control-value"
      });
      volumeSlider.addEventListener("input", (e) => {
        const value = parseFloat(e.target.value);
        volumeValue.setText(`${Math.round(value * 100)}%`);
        if (this.currentAudio) {
          this.currentAudio.volume = value;
        }
      });
      this.volumeSlider = volumeSlider;
    }
    const closeBtn = contentEl.createEl("button", {
      text: "\u274C \uB2EB\uAE30",
      cls: "player-close-btn"
    });
    closeBtn.onclick = () => {
      this.close();
    };
    this.addStyles();
  }
  async play() {
    if (this.playerData.type === "text") {
      await this.playText();
    } else {
      await this.playAudio();
    }
  }
  async playText() {
    const utterance = new SpeechSynthesisUtterance(this.playerData.content);
    const voice = this.plugin.availableVoices.find((v) => v.name === this.plugin.settings.browserVoice);
    if (voice) {
      utterance.voice = voice;
    }
    utterance.rate = parseFloat(this.speedSlider.value);
    utterance.volume = parseFloat(this.volumeSlider.value);
    utterance.lang = this.plugin.settings.language;
    utterance.onstart = () => {
      this.isPlaying = true;
      this.playPauseBtn.setText("\u23F8\uFE0F \uC77C\uC2DC\uC815\uC9C0");
      new import_obsidian.Notice("\u{1F50A} \uC7AC\uC0DD \uC911...");
    };
    utterance.onend = () => {
      this.isPlaying = false;
      this.playPauseBtn.setText("\u25B6\uFE0F \uC7AC\uC0DD");
      new import_obsidian.Notice("\u2705 \uC7AC\uC0DD \uC644\uB8CC");
      this.currentUtterance = null;
    };
    utterance.onerror = (error) => {
      this.isPlaying = false;
      this.playPauseBtn.setText("\u25B6\uFE0F \uC7AC\uC0DD");
      new import_obsidian.Notice("\u274C \uC7AC\uC0DD \uC624\uB958: " + error.error);
      this.currentUtterance = null;
    };
    this.currentUtterance = utterance;
    this.plugin.synthesis.speak(utterance);
  }
  async playAudio() {
    try {
      const file = this.app.vault.getAbstractFileByPath(this.playerData.filePath);
      if (file) {
        const arrayBuffer = await this.app.vault.readBinary(file);
        let mimeType = "audio/webm";
        const extension = this.playerData.filePath.toLowerCase().split(".").pop();
        if (extension === "mp3") {
          mimeType = "audio/mpeg";
        } else if (extension === "ogg") {
          mimeType = "audio/ogg";
        } else if (extension === "wav") {
          mimeType = "audio/wav";
        } else if (extension === "m4a" || extension === "mp4") {
          mimeType = "audio/mp4";
        } else if (extension === "webm") {
          mimeType = "audio/webm";
        }
        console.log("Playing audio with MIME type:", mimeType, "for file:", this.playerData.filePath);
        const blob = new Blob([arrayBuffer], { type: mimeType });
        const audioUrl = URL.createObjectURL(blob);
        this.currentAudio = new Audio(audioUrl);
        this.currentAudio.volume = parseFloat(this.volumeSlider.value);
        this.currentAudio.onplay = () => {
          this.isPlaying = true;
          this.playPauseBtn.setText("\u23F8\uFE0F \uC77C\uC2DC\uC815\uC9C0");
          new import_obsidian.Notice("\u{1F50A} \uC7AC\uC0DD \uC911...");
          this.startProgressUpdate();
        };
        this.currentAudio.onpause = () => {
          this.isPlaying = false;
          this.playPauseBtn.setText("\u25B6\uFE0F \uC7AC\uC0DD");
          this.stopProgressUpdate();
        };
        this.currentAudio.onended = () => {
          this.isPlaying = false;
          this.playPauseBtn.setText("\u25B6\uFE0F \uC7AC\uC0DD");
          URL.revokeObjectURL(audioUrl);
          new import_obsidian.Notice("\u2705 \uC7AC\uC0DD \uC644\uB8CC");
          this.currentAudio = null;
          this.stopProgressUpdate();
          this.updateProgress(100);
        };
        this.currentAudio.onerror = (error) => {
          this.isPlaying = false;
          this.playPauseBtn.setText("\u25B6\uFE0F \uC7AC\uC0DD");
          URL.revokeObjectURL(audioUrl);
          new import_obsidian.Notice("\u274C \uC624\uB514\uC624 \uC7AC\uC0DD \uC2E4\uD328 - \uD30C\uC77C \uD615\uC2DD\uC744 \uD655\uC778\uD558\uC138\uC694");
          console.error("Audio playback error:", error);
          console.error("File path:", this.playerData.filePath);
          console.error("MIME type used:", mimeType);
          this.currentAudio = null;
          this.stopProgressUpdate();
        };
        this.currentAudio.onloadedmetadata = () => {
          this.duration = this.currentAudio.duration;
          this.updateTimeDisplay();
        };
        await this.currentAudio.play();
      }
    } catch (error) {
      new import_obsidian.Notice("\u274C \uD30C\uC77C \uC7AC\uC0DD \uC2E4\uD328: " + error.message);
      console.error("Play audio error:", error);
    }
  }
  pause() {
    if (this.playerData.type === "text") {
      this.plugin.synthesis.pause();
      this.isPlaying = false;
      this.playPauseBtn.setText("\u25B6\uFE0F \uC7AC\uC0DD");
    } else if (this.currentAudio) {
      this.currentAudio.pause();
    }
  }
  stop() {
    if (this.playerData.type === "text") {
      this.plugin.synthesis.cancel();
      this.isPlaying = false;
      this.playPauseBtn.setText("\u25B6\uFE0F \uC7AC\uC0DD");
      this.currentUtterance = null;
      new import_obsidian.Notice("\u23F9\uFE0F \uC815\uC9C0\uB428");
    } else if (this.currentAudio) {
      this.currentAudio.pause();
      this.currentAudio.currentTime = 0;
      this.isPlaying = false;
      this.playPauseBtn.setText("\u25B6\uFE0F \uC7AC\uC0DD");
      this.updateProgress(0);
      this.updateTimeDisplay();
      new import_obsidian.Notice("\u23F9\uFE0F \uC815\uC9C0\uB428");
    }
  }
  startProgressUpdate() {
    this.progressInterval = setInterval(() => {
      if (this.currentAudio) {
        const progress = this.currentAudio.currentTime / this.currentAudio.duration * 100;
        this.updateProgress(progress);
        this.currentTime = this.currentAudio.currentTime;
        this.updateTimeDisplay();
      }
    }, 100);
  }
  stopProgressUpdate() {
    if (this.progressInterval) {
      clearInterval(this.progressInterval);
      this.progressInterval = null;
    }
  }
  updateProgress(percentage) {
    if (this.progressFill) {
      this.progressFill.style.width = `${percentage}%`;
    }
  }
  updateTimeDisplay() {
    if (this.timeDisplay) {
      const current = this.formatTime(this.currentTime);
      const total = this.formatTime(this.duration);
      this.timeDisplay.setText(`${current} / ${total}`);
    }
  }
  formatTime(seconds) {
    if (!seconds || isNaN(seconds))
      return "0:00";
    const mins = Math.floor(seconds / 60);
    const secs = Math.floor(seconds % 60);
    return `${mins}:${secs.toString().padStart(2, "0")}`;
  }
  addStyles() {
    const style = document.createElement("style");
    style.textContent = `
            .tts-player-modal {
                padding: 20px;
                max-width: 500px;
            }
            
            .player-header h2 {
                margin-bottom: 20px;
                text-align: center;
            }
            
            .player-file-info {
                background: var(--background-secondary);
                padding: 15px;
                border-radius: 8px;
                margin-bottom: 20px;
            }
            
            .player-filename {
                font-size: 16px;
                font-weight: bold;
                color: var(--text-normal);
                margin-bottom: 5px;
            }
            
            .player-filesize {
                font-size: 14px;
                color: var(--text-muted);
            }
            
            .player-progress-section {
                margin-bottom: 20px;
            }
            
            .player-progress-bar {
                width: 100%;
                height: 8px;
                background: var(--background-modifier-border);
                border-radius: 4px;
                overflow: hidden;
                margin-bottom: 8px;
            }
            
            .player-progress-fill {
                height: 100%;
                width: 0%;
                background: var(--interactive-accent);
                transition: width 0.1s linear;
            }
            
            .player-time-display {
                text-align: center;
                font-size: 14px;
                color: var(--text-muted);
            }
            
            .player-controls {
                display: flex;
                gap: 10px;
                justify-content: center;
                margin-bottom: 20px;
                flex-wrap: wrap;
            }
            
            .player-btn {
                padding: 12px 20px;
                border-radius: 8px;
                border: none;
                cursor: pointer;
                font-size: 14px;
                font-weight: 500;
                transition: all 0.2s;
            }
            
            .play-pause-btn {
                background: var(--interactive-accent);
                color: white;
                min-width: 120px;
            }
            
            .play-pause-btn:hover {
                opacity: 0.8;
            }
            
            .stop-btn {
                background: #f44336;
                color: white;
            }
            
            .stop-btn:hover {
                opacity: 0.8;
            }
            
            .open-file-btn {
                background: var(--background-secondary);
                color: var(--text-normal);
                border: 1px solid var(--background-modifier-border);
            }
            
            .open-file-btn:hover {
                background: var(--background-modifier-hover);
            }
            
            .player-settings-section {
                margin-bottom: 20px;
            }
            
            .player-settings-section h3 {
                font-size: 14px;
                margin-bottom: 10px;
                color: var(--text-normal);
            }
            
            .player-control-row {
                display: flex;
                align-items: center;
                gap: 15px;
                margin-bottom: 12px;
            }
            
            .player-control-row label {
                min-width: 60px;
                font-weight: 500;
                font-size: 14px;
            }
            
            .player-control-row input[type="range"] {
                flex: 1;
            }
            
            .player-control-value {
                min-width: 50px;
                text-align: right;
                font-weight: bold;
                color: var(--interactive-accent);
                font-size: 14px;
            }
            
            .player-close-btn {
                width: 100%;
                padding: 12px;
                border-radius: 8px;
                border: none;
                background: var(--background-secondary);
                color: var(--text-normal);
                cursor: pointer;
                font-size: 14px;
                font-weight: 500;
            }
            
            .player-close-btn:hover {
                background: var(--background-modifier-hover);
            }
            
            /* \uBAA8\uBC14\uC77C \uBC18\uC751\uD615 \uCD5C\uC801\uD654 */
            @media (max-width: 768px) {
                .tts-player-modal {
                    padding: 15px;
                    max-width: 95vw;
                }
                
                .player-header h2 {
                    font-size: 18px;
                }
                
                .player-controls {
                    padding: 10px 0;
                    flex-wrap: wrap;
                    gap: 8px;
                }
                
                .player-btn {
                    flex: 1 1 calc(50% - 4px);
                    min-width: calc(50% - 4px);
                    padding: 10px 8px;
                    font-size: 13px;
                }
                
                .player-control-row {
                    flex-direction: column;
                    align-items: stretch;
                    gap: 8px;
                }
                
                .player-control-row label {
                    min-width: auto;
                }
                
                .player-control-value {
                    text-align: left;
                }
                
                .player-time-display {
                    font-size: 12px;
                }
            }
            
            @media (max-width: 480px) {
                .tts-player-modal {
                    padding: 10px;
                }
                
                .player-header h2 {
                    font-size: 16px;
                }
                
                .player-filename {
                    font-size: 14px;
                }
                
                .player-filesize {
                    font-size: 12px;
                }
                
                .player-controls {
                    gap: 6px;
                }
                
                .player-btn {
                    flex: 1 1 100%;
                    min-width: 100%;
                    padding: 12px;
                    font-size: 14px;
                }
                
                .player-progress-bar {
                    height: 6px;
                }
            }
            
            /* \uD130\uCE58 \uB514\uBC14\uC774\uC2A4 \uCD5C\uC801\uD654 */
            @media (hover: none) and (pointer: coarse) {
                .player-btn {
                    min-height: 44px;
                    padding: 12px 16px;
                }
                
                .player-btn:active {
                    transform: scale(0.95);
                }
                
                .player-close-btn {
                    min-height: 44px;
                }
            }
        `;
    document.head.appendChild(style);
  }
  onClose() {
    const { contentEl } = this;
    if (this.playerData.type === "text") {
      this.plugin.synthesis.cancel();
    } else if (this.currentAudio) {
      this.currentAudio.pause();
      this.currentAudio = null;
    }
    this.stopProgressUpdate();
    contentEl.empty();
  }
};
